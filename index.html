<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Baguette</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-dark: #0d0d12;
      --void-core: #7b2cbf;
      --void-mid: #9d4edd;
      --flame-core: #ff6b35;
      --flame-mid: #f7931e;
    }

    html, body {
      height: 100%;
      width: 100%;
      background: #2c2c3a;
      font-family: 'Press Start 2P', cursive;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .gameboy-shell {
      background: linear-gradient(145deg, #6b5b95 0%, #5a4a84 50%, #4a3a74 100%);
      padding: 1.2rem 0.8rem 2rem 0.8rem;
      border-radius: 15px 15px 50px 50px;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.2), 0 10px 40px rgba(0,0,0,0.5);
      position: relative;
    }

    .gameboy-label {
      position: absolute;
      top: 0.4rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 8px;
      color: rgba(255,255,255,0.7);
      white-space: nowrap;
    }

    .gameboy-label span {
      background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff, #9d65c9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .screen-bezel {
      background: #1a1a24;
      padding: 0.4rem;
      border-radius: 6px;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.8);
    }

    .viewport {
      width: min(88vw, 88vh, 500px);
      height: min(88vw, 88vh, 500px);
      background: linear-gradient(180deg, #88c8e8 0%, #78b8d8 30%, #98d868 60%, #78b858 100%);
      border-radius: 3px;
      position: relative;
      overflow: hidden;
      image-rendering: pixelated;
    }

    .viewport.shake {
      animation: screenShake 0.3s ease-out;
    }

    @keyframes screenShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-3px); }
      80% { transform: translateX(3px); }
    }

    /* Scanlines */
    .viewport::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
      pointer-events: none;
      z-index: 50;
    }

    /* Pokemon-style HP boxes - FireRed layout */
    .stat-box {
      position: absolute;
      background: linear-gradient(180deg, #f8f0d8 0%, #e8e0c8 100%);
      border: 3px solid #484038;
      padding: 6px 10px;
      min-width: 44%;
      z-index: 20;
    }

    .stat-box.enemy {
      top: 2%;
      left: 2%;
      border-radius: 0 0 10px 0;
    }

    .stat-box.player {
      bottom: 34%;
      right: 2%;
      border-radius: 10px 0 0 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .stat-name {
      font-size: 14px;
      color: #303030;
      letter-spacing: -0.5px;
    }

    .stat-level {
      font-size: 12px;
      color: #303030;
    }

    .stat-level::before {
      content: 'Lv';
      font-size: 10px;
      margin-right: 2px;
    }

    .hp-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hp-label {
      font-size: 10px;
      color: #f8a800;
      font-weight: bold;
    }

    .hp-bar-bg {
      flex: 1;
      height: 12px;
      background: #484038;
      border-radius: 6px;
      padding: 2px;
    }

    .hp-bar-inner {
      height: 100%;
      background: linear-gradient(180deg, #58f858 0%, #20b820 100%);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .hp-bar-inner.medium {
      background: linear-gradient(180deg, #f8d830 0%, #c8a820 100%);
    }

    .hp-bar-inner.low {
      background: linear-gradient(180deg, #f85858 0%, #c82020 100%);
    }

    .hp-numbers {
      text-align: right;
      font-size: 11px;
      color: #303030;
      margin-top: 4px;
    }

    /* Battle arena */
    .battle-arena {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 32%;
    }

    /* Ground platforms - Pokemon FireRed style */
    .platform-enemy {
      position: absolute;
      top: 32%;
      right: 8%;
      width: 35%;
      height: 12px;
      background: linear-gradient(180deg, #90b058 0%, #78a048 100%);
      border-radius: 50%;
      box-shadow: 0 4px 0 #608030;
    }

    .platform-player {
      position: absolute;
      bottom: 2%;
      left: 3%;
      width: 45%;
      height: 16px;
      background: linear-gradient(180deg, #90b058 0%, #78a048 100%);
      border-radius: 50%;
      box-shadow: 0 6px 0 #608030;
    }

    /* Pixel art creatures - FireRed positions */
    .creature {
      position: absolute;
      image-rendering: pixelated;
      z-index: 10;
    }

    .creature-enemy {
      top: 8%;
      right: 18%;
      transform: scaleX(-1);
    }

    .creature-player {
      bottom: 38%;
      left: 15%;
    }

    .pixel-sprite {
      width: 1px;
      height: 1px;
      transform-origin: center;
    }

    /* FLAME BAGUETTE - Player sprite */
    .flame-sprite {
      transform: scale(5);
    }

    .flame-sprite .pixel-sprite {
      box-shadow:
        /* FLAME BAGUETTE - Upper-left light, hue-shifted palette */
        /* Palette: Shadow #8B5A2B (sienna) → Mid #D4A574 (tan) → Highlight #FFF4D6 (cream) */

        /* Flame crown - light from upper-left */
        7px 3px 0 #fffbe8, 8px 2px 0 #fffbe8,
        6px 4px 0 #ffe066, 7px 4px 0 #fffbe8, 8px 3px 0 #fffbe8, 9px 4px 0 #ffc233,
        5px 5px 0 #ff9500, 6px 5px 0 #ffcc00, 7px 5px 0 #ffe066, 8px 4px 0 #ffe066, 9px 5px 0 #ffc233, 10px 5px 0 #ff7700,
        5px 6px 0 #cc4400, 6px 6px 0 #ff6600, 7px 6px 0 #ff9500, 8px 5px 0 #ffcc00, 9px 6px 0 #ff6600, 10px 6px 0 #cc4400,
        6px 7px 0 #991100, 7px 7px 0 #cc4400, 8px 6px 0 #ff6600, 9px 7px 0 #991100,

        /* Baguette body - upper-left highlight, bottom-right shadow */
        6px 8px 0 #fff4d6, 7px 8px 0 #ffe8b8, 8px 8px 0 #e8c097, 9px 8px 0 #d4a574, 10px 8px 0 #c99a65,
        5px 9px 0 #fff4d6, 6px 9px 0 #ffe8b8, 7px 9px 0 #e8c097, 8px 9px 0 #d4a574, 9px 9px 0 #c99a65, 10px 9px 0 #b8894f, 11px 9px 0 #a67c3d,
        5px 10px 0 #ffe8b8, 6px 10px 0 #e8c097, 7px 10px 0 #d4a574, 8px 10px 0 #c99a65, 9px 10px 0 #b8894f, 10px 10px 0 #a67c3d, 11px 10px 0 #8b5a2b,
        5px 11px 0 #e8c097, 6px 11px 0 #d4a574, 7px 11px 0 #c99a65, 8px 11px 0 #b8894f, 9px 11px 0 #a67c3d, 10px 11px 0 #8b5a2b, 11px 11px 0 #704214,
        6px 12px 0 #c99a65, 7px 12px 0 #b8894f, 8px 12px 0 #a67c3d, 9px 12px 0 #8b5a2b, 10px 12px 0 #704214,
        7px 13px 0 #8b5a2b, 8px 13px 0 #704214, 9px 13px 0 #5c3317,

        /* Crust score marks - follow form */
        6px 9px 0 #c99a65, 7px 10px 0 #a67c3d, 8px 11px 0 #8b5a2b,

        /* Eyes - clear focal point with catchlight */
        6px 9px 0 #1a1a24, 7px 9px 0 #ffffff, 9px 9px 0 #1a1a24, 10px 9px 0 #ffffff,
        6px 10px 0 #1a1a24, 9px 10px 0 #1a1a24,

        /* Blush - warm on lit side, cooler on shadow */
        5px 10px 0 #ffb8a8, 11px 10px 0 #e89888,

        /* Feet - grounded */
        6px 14px 0 #704214, 7px 14px 0 #8b5a2b, 9px 14px 0 #5c3317, 10px 14px 0 #4a2c0a;
    }

    /* MEGA BAGUETTE - Evolved form! Bigger, more flames */
    .mega-flame-sprite {
      transform: scale(6);
    }

    .mega-flame-sprite .pixel-sprite {
      box-shadow:
        /* MEGA BAGUETTE - Evolved form with massive flame crown */

        /* Intense flame crown - towering inferno */
        8px 0px 0 #ffffff, 9px 0px 0 #fffbe8,
        7px 1px 0 #fffbe8, 8px 1px 0 #ffffff, 9px 1px 0 #fffbe8, 10px 1px 0 #ffe066,
        6px 2px 0 #ffe066, 7px 2px 0 #fffbe8, 8px 2px 0 #ffffff, 9px 2px 0 #fffbe8, 10px 2px 0 #ffe066, 11px 2px 0 #ffc233,
        5px 3px 0 #ffc233, 6px 3px 0 #ffe066, 7px 3px 0 #fffbe8, 8px 3px 0 #fffbe8, 9px 3px 0 #ffe066, 10px 3px 0 #ffc233, 11px 3px 0 #ff9500, 12px 3px 0 #ff7700,
        4px 4px 0 #ff9500, 5px 4px 0 #ffcc00, 6px 4px 0 #ffe066, 7px 4px 0 #fffbe8, 8px 4px 0 #ffe066, 9px 4px 0 #ffcc00, 10px 4px 0 #ff9500, 11px 4px 0 #ff6600, 12px 4px 0 #cc4400,
        4px 5px 0 #ff7700, 5px 5px 0 #ff9500, 6px 5px 0 #ffcc00, 7px 5px 0 #ffe066, 8px 5px 0 #ffcc00, 9px 5px 0 #ff9500, 10px 5px 0 #ff6600, 11px 5px 0 #cc4400, 12px 5px 0 #991100,
        5px 6px 0 #cc4400, 6px 6px 0 #ff6600, 7px 6px 0 #ff9500, 8px 6px 0 #ff9500, 9px 6px 0 #ff6600, 10px 6px 0 #cc4400, 11px 6px 0 #991100,
        6px 7px 0 #991100, 7px 7px 0 #cc4400, 8px 7px 0 #ff6600, 9px 7px 0 #cc4400, 10px 7px 0 #991100,

        /* Side flame wings */
        3px 4px 0 #fffbe8, 2px 5px 0 #ffe066, 3px 5px 0 #ffcc00, 3px 6px 0 #ff9500, 2px 6px 0 #ff6600, 2px 7px 0 #cc4400,
        14px 4px 0 #ffe066, 14px 5px 0 #ffc233, 13px 5px 0 #ff9500, 14px 6px 0 #ff6600, 13px 6px 0 #cc4400, 13px 7px 0 #991100,

        /* Larger baguette body */
        5px 8px 0 #fff4d6, 6px 8px 0 #fff4d6, 7px 8px 0 #ffe8b8, 8px 8px 0 #e8c097, 9px 8px 0 #d4a574, 10px 8px 0 #c99a65, 11px 8px 0 #b8894f,
        4px 9px 0 #fff4d6, 5px 9px 0 #ffe8b8, 6px 9px 0 #ffe8b8, 7px 9px 0 #e8c097, 8px 9px 0 #d4a574, 9px 9px 0 #c99a65, 10px 9px 0 #b8894f, 11px 9px 0 #a67c3d, 12px 9px 0 #8b5a2b,
        4px 10px 0 #ffe8b8, 5px 10px 0 #e8c097, 6px 10px 0 #e8c097, 7px 10px 0 #d4a574, 8px 10px 0 #c99a65, 9px 10px 0 #b8894f, 10px 10px 0 #a67c3d, 11px 10px 0 #8b5a2b, 12px 10px 0 #704214,
        4px 11px 0 #e8c097, 5px 11px 0 #d4a574, 6px 11px 0 #d4a574, 7px 11px 0 #c99a65, 8px 11px 0 #b8894f, 9px 11px 0 #a67c3d, 10px 11px 0 #8b5a2b, 11px 11px 0 #704214, 12px 11px 0 #5c3317,
        5px 12px 0 #c99a65, 6px 12px 0 #c99a65, 7px 12px 0 #b8894f, 8px 12px 0 #a67c3d, 9px 12px 0 #8b5a2b, 10px 12px 0 #704214, 11px 12px 0 #5c3317,
        6px 13px 0 #a67c3d, 7px 13px 0 #8b5a2b, 8px 13px 0 #704214, 9px 13px 0 #5c3317, 10px 13px 0 #4a2c0a,

        /* Determined eyes with fire reflection */
        5px 9px 0 #1a1a24, 6px 9px 0 #ff6600, 6px 10px 0 #1a1a24,
        10px 9px 0 #1a1a24, 11px 9px 0 #ff6600, 10px 10px 0 #1a1a24,

        /* Battle-ready blush */
        4px 10px 0 #ff8866, 12px 10px 0 #cc6644,

        /* Sturdy feet */
        5px 14px 0 #5c3317, 6px 14px 0 #704214, 7px 14px 0 #8b5a2b, 9px 14px 0 #5c3317, 10px 14px 0 #4a2c0a, 11px 14px 0 #3a1c00;
    }

    /* Evolution animations - dramatic Pokemon style */
    @keyframes evolve-pulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.15); filter: brightness(1.5); }
    }

    @keyframes evolve-glow {
      0% { filter: brightness(1) drop-shadow(0 0 0 #fff); }
      20% { filter: brightness(2) drop-shadow(0 0 30px #fff); }
      40% { filter: brightness(4) drop-shadow(0 0 60px #ffe066); }
      60% { filter: brightness(6) drop-shadow(0 0 80px #fff); }
      80% { filter: brightness(3) drop-shadow(0 0 40px #ff9500); }
      100% { filter: brightness(1.2) drop-shadow(0 0 10px #ff6600); }
    }

    @keyframes evolve-silhouette {
      0%, 100% { filter: brightness(1); }
      30%, 70% { filter: brightness(0) drop-shadow(0 0 50px #fff); }
    }

    @keyframes evolve-shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }

    .evolving {
      animation: evolve-pulse 0.4s ease-in-out infinite, evolve-shake 0.5s ease-in-out infinite;
    }

    .evolving-flash {
      animation: evolve-glow 2.5s ease-in-out forwards, evolve-silhouette 2.5s ease-in-out forwards;
    }

    /* Pokemon-style evolution - in place with particles */
    @keyframes evo-flash {
      0%, 100% { filter: brightness(1); }
      25%, 75% { filter: brightness(0) drop-shadow(0 0 20px #fff); }
      50% { filter: brightness(3) drop-shadow(0 0 40px #fff); }
    }

    .evo-flashing {
      animation: evo-flash 0.6s ease-in-out infinite;
    }

    /* Tornado particle around player sprite */
    .evo-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #fff 0%, #aaf 100%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 30;
      box-shadow: 0 0 8px #fff;
    }

    @keyframes tornado-spin {
      0% { transform: rotate(0deg) translateX(60px) scale(1.2); opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { transform: rotate(540deg) translateX(5px) scale(0.3); opacity: 0; }
    }

    /* VOID SPECTER - Enemy sprite */
    .void-sprite {
      transform: scale(5);
    }

    .void-sprite .pixel-sprite {
      box-shadow:
        /* VOID SPECTER - Upper-left light, hue-shifted palette */
        /* Palette: Shadow #1a0533 (blue-violet) → Mid #7b2cbf (purple) → Highlight #e8c8ff (pink-lavender) */

        /* Hood peak - lit from upper-left */
        7px 3px 0 #e8c8ff, 8px 3px 0 #c77dff, 9px 3px 0 #9d4edd,
        6px 4px 0 #e8c8ff, 7px 4px 0 #c77dff, 8px 4px 0 #9d4edd, 9px 4px 0 #7b2cbf, 10px 4px 0 #5a189a,

        /* Cloak body - dramatic light falloff */
        5px 5px 0 #c77dff, 6px 5px 0 #9d4edd, 7px 5px 0 #7b2cbf, 8px 5px 0 #5a189a, 9px 5px 0 #3c096c, 10px 5px 0 #240046, 11px 5px 0 #1a0533,
        4px 6px 0 #e8c8ff, 5px 6px 0 #9d4edd, 6px 6px 0 #7b2cbf, 7px 6px 0 #5a189a, 8px 6px 0 #3c096c, 9px 6px 0 #240046, 10px 6px 0 #1a0533, 11px 6px 0 #0d0018, 12px 6px 0 #0d0018,
        4px 7px 0 #c77dff, 5px 7px 0 #9d4edd, 6px 7px 0 #7b2cbf, 7px 7px 0 #5a189a, 8px 7px 0 #3c096c, 9px 7px 0 #240046, 10px 7px 0 #1a0533, 11px 7px 0 #0d0018, 12px 7px 0 #0d0018,
        4px 8px 0 #9d4edd, 5px 8px 0 #7b2cbf, 6px 8px 0 #5a189a, 7px 8px 0 #3c096c, 8px 8px 0 #240046, 9px 8px 0 #1a0533, 10px 8px 0 #0d0018, 11px 8px 0 #0d0018, 12px 8px 0 #0d0018,
        5px 9px 0 #7b2cbf, 6px 9px 0 #5a189a, 7px 9px 0 #3c096c, 8px 9px 0 #240046, 9px 9px 0 #1a0533, 10px 9px 0 #0d0018, 11px 9px 0 #0d0018,
        5px 10px 0 #5a189a, 6px 10px 0 #3c096c, 7px 10px 0 #240046, 8px 10px 0 #1a0533, 9px 10px 0 #0d0018, 10px 10px 0 #0d0018,

        /* Wispy tail - fading into void */
        5px 11px 0 #3c096c, 6px 11px 0 #240046, 8px 11px 0 #1a0533, 10px 11px 0 #0d0018,
        4px 12px 0 #3c096c, 7px 12px 0 #1a0533, 9px 12px 0 #0d0018,
        5px 13px 0 #240046, 8px 13px 0 #0d0018,
        6px 14px 0 #1a0533,

        /* Glowing eyes - focal point with glow effect */
        5px 6px 0 #ffcccc, 6px 6px 0 #ff4444, 7px 6px 0 #ff0000, 8px 7px 0 #cc0000,
        5px 7px 0 #ffffff, 6px 7px 0 #ff6666,
        9px 6px 0 #ff4444, 10px 6px 0 #ff8888,
        9px 7px 0 #ff0000, 10px 7px 0 #ffffff;
    }

    /* SLIME - Second enemy sprite (green slime) */
    .slime-sprite {
      transform: scale(5);
    }

    .slime-sprite .pixel-sprite {
      box-shadow:
        /* SLIME - Upper-left light, hue-shifted palette */
        /* Palette: Shadow #1a6060 (teal) → Mid #4a9f4a (green) → Highlight #d4ff98 (yellow-green) */

        /* Top dome - brightest on upper-left */
        6px 5px 0 #e8ffb8, 7px 5px 0 #d4ff98, 8px 5px 0 #b8f878, 9px 5px 0 #8bd858,
        5px 6px 0 #e8ffb8, 6px 6px 0 #d4ff98, 7px 6px 0 #b8f878, 8px 6px 0 #8bd858, 9px 6px 0 #6bcf6b, 10px 6px 0 #4a9f4a, 11px 6px 0 #2a7f5a,

        /* Main body - gradient flows to bottom-right shadow */
        4px 7px 0 #d4ff98, 5px 7px 0 #b8f878, 6px 7px 0 #8bd858, 7px 7px 0 #6bcf6b, 8px 7px 0 #4a9f4a, 9px 7px 0 #3a8f5a, 10px 7px 0 #2a7f5a, 11px 7px 0 #1a6060, 12px 7px 0 #1a6060,
        4px 8px 0 #b8f878, 5px 8px 0 #8bd858, 6px 8px 0 #6bcf6b, 7px 8px 0 #4a9f4a, 8px 8px 0 #3a8f5a, 9px 8px 0 #2a7f5a, 10px 8px 0 #1a6060, 11px 8px 0 #156050, 12px 8px 0 #105040,
        4px 9px 0 #8bd858, 5px 9px 0 #6bcf6b, 6px 9px 0 #4a9f4a, 7px 9px 0 #3a8f5a, 8px 9px 0 #2a7f5a, 9px 9px 0 #1a6060, 10px 9px 0 #156050, 11px 9px 0 #105040, 12px 9px 0 #0a4030,
        5px 10px 0 #4a9f4a, 6px 10px 0 #3a8f5a, 7px 10px 0 #2a7f5a, 8px 10px 0 #1a6060, 9px 10px 0 #156050, 10px 10px 0 #105040, 11px 10px 0 #0a4030,

        /* Base spread - darkest teal at bottom */
        5px 11px 0 #2a7f5a, 6px 11px 0 #1a6060, 7px 11px 0 #156050, 8px 11px 0 #105040, 9px 11px 0 #0a4030, 10px 11px 0 #0a4030, 11px 11px 0 #053020,
        6px 12px 0 #156050, 7px 12px 0 #105040, 8px 12px 0 #0a4030, 9px 12px 0 #053020, 10px 12px 0 #053020,

        /* Eyes - large and focal, upper-left catchlight */
        5px 6px 0 #ffffff, 6px 6px 0 #ffffff, 6px 7px 0 #ffffff,
        5px 7px 0 #e8e8ff, 7px 7px 0 #1a1a24, 6px 8px 0 #1a1a24,
        9px 6px 0 #ffffff, 10px 6px 0 #f0f0ff,
        9px 7px 0 #e8e8ff, 10px 7px 0 #1a1a24, 9px 8px 0 #1a1a24,

        /* Specular highlight - crisp white on lit side */
        5px 5px 0 #ffffff, 6px 5px 0 #ffffff,

        /* Drip on shaded side only - follows gravity */
        12px 10px 0 #105040, 12px 11px 0 #0a4030, 12px 12px 0 #053020, 12px 13px 0 #053020;
    }

    /* EXP bar */
    .exp-bar-container {
      position: absolute;
      bottom: 34%;
      right: 2%;
      width: 44%;
      z-index: 21;
    }

    .exp-bar-bg {
      height: 6px;
      background: #484038;
      border-radius: 3px;
      overflow: hidden;
    }

    .exp-bar-inner {
      height: 100%;
      background: linear-gradient(180deg, #58c8f8 0%, #2090c8 100%);
      width: 0%;
      transition: width 1s ease-out;
    }

    /* Faint animation */
    @keyframes faintDrop {
      0% { transform: translateY(0) scaleX(-1); opacity: 1; }
      100% { transform: translateY(60px) scaleX(-1); opacity: 0; }
    }

    .creature-enemy.fainting {
      animation: faintDrop 0.8s ease-in forwards !important;
    }

    /* Appear animation */
    @keyframes appearPop {
      0% { transform: scale(0) scaleX(-1); opacity: 0; }
      50% { transform: scale(1.2) scaleX(-1); }
      100% { transform: scale(1) scaleX(-1); opacity: 1; }
    }

    .creature-enemy.appearing {
      animation: appearPop 0.5s ease-out forwards !important;
    }

    /* Creature animations */
    @keyframes creatureBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @keyframes enemyFloat {
      0%, 100% { transform: translateY(0) scaleX(-1); }
      50% { transform: translateY(-8px) scaleX(-1); }
    }

    .creature-player { animation: creatureBounce 1s ease-in-out infinite; }
    .creature-enemy { animation: enemyFloat 1.5s ease-in-out infinite; }

    /* Attack flash */
    @keyframes hitFlash {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(3) saturate(0); }
    }

    .creature.hit {
      animation: hitFlash 0.1s ease-in-out 4 !important;
    }

    /* Bottom battle panel - FireRed style */
    .battle-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: flex;
      z-index: 30;
    }

    .message-box {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 12px 14px;
      display: flex;
      align-items: flex-start;
    }

    .message-text {
      font-size: 15px;
      color: #303030;
      line-height: 1.6;
    }

    .action-box {
      width: 46%;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 8px 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      align-items: center;
    }

    .action-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 13px;
      padding: 10px 4px 10px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      white-space: nowrap;
    }

    .action-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 10px;
    }

    .action-btn:hover::before,
    .action-btn:active::before { opacity: 1; }

    /* Fight panel - FireRed style */
    .fight-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: none;
      z-index: 31;
    }

    .fight-panel.active { display: flex; }

    .moves-box {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      padding: 8px;
      align-items: center;
    }

    .move-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      padding: 8px 4px 8px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      white-space: nowrap;
    }

    .move-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 9px;
    }

    .move-btn:hover::before,
    .move-btn:active::before { opacity: 1; }

    .move-info {
      width: 32%;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 12px;
      font-size: 12px;
      color: #303030;
      line-height: 1.8;
    }

    /* Items panel - FireRed style */
    .items-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: none;
      z-index: 31;
    }

    .items-panel.active { display: flex; }

    .items-list {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .item-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      padding: 10px 4px 10px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      display: flex;
      justify-content: space-between;
    }

    .item-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 9px;
    }

    .item-btn:hover::before,
    .item-btn:active::before { opacity: 1; }

    .item-count { color: #606060; }

    /* PARTICLE SYSTEMS */
    .particle {
      position: absolute;
      pointer-events: none;
      z-index: 45;
    }

    /* Fire particles - teardrop wisps */
    .fire-particle {
      width: 8px;
      height: 12px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 40%, #ff6b35 80%, transparent 100%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      animation: fireWisp 0.6s ease-out forwards;
    }

    @keyframes fireWisp {
      0% { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: scale(0.2) translateY(-35px) rotate(var(--rot, 30deg)); }
    }

    /* Ember particles - sparks that scatter */
    .ember-particle {
      width: 4px;
      height: 8px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 50%, #ff6b35 100%);
      border-radius: 50% 50% 20% 20%;
      box-shadow: 0 0 6px #ff6b35, 0 0 12px #ffd23f;
      animation: emberSpark 0.5s ease-out forwards;
    }

    @keyframes emberSpark {
      0% { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); }
      50% { opacity: 1; }
      100% { opacity: 0; transform: scale(0.3) translateY(-25px) translateX(var(--dx)) rotate(180deg); }
    }

    /* Flamethrower stream particles */
    .flame-stream-particle {
      width: 16px;
      height: 10px;
      background: linear-gradient(90deg, #cc3300 0%, #ff6b35 30%, #ffd23f 60%, #fff 100%);
      border-radius: 30% 70% 70% 30% / 50%;
      box-shadow: 0 0 15px #ff6b35, 0 0 30px #f7931e;
      animation: flameStreamParticle 0.4s ease-out forwards;
    }

    @keyframes flameStreamParticle {
      0% { opacity: 1; transform: scale(1.2) scaleX(1.5); }
      100% { opacity: 0; transform: scale(0.3) scaleX(0.5) translateY(-10px); }
    }

    /* Shadow Ball */
    .shadow-particle {
      width: 12px;
      height: 12px;
      background: radial-gradient(circle, #e0aaff 0%, #9d4edd 40%, #7b2cbf 70%, #3c096c 100%);
      border-radius: 50%;
      box-shadow: 0 0 10px #9d4edd, 0 0 20px #7b2cbf;
      animation: shadowPulse 0.5s ease-out forwards;
    }

    @keyframes shadowPulse {
      0% { opacity: 1; transform: scale(1); filter: brightness(1); }
      50% { filter: brightness(1.5); }
      100% { opacity: 0; transform: scale(0.2); }
    }

    /* Fire Blast - explosive star bursts */
    .blast-particle {
      width: 28px;
      height: 28px;
      background: radial-gradient(circle, #fff 0%, #ffd23f 25%, #ff6b35 50%, #cc3300 75%, #660000 100%);
      clip-path: polygon(50% 0%, 65% 35%, 100% 50%, 65% 65%, 50% 100%, 35% 65%, 0% 50%, 35% 35%);
      box-shadow: 0 0 30px #ff6b35, 0 0 60px #f7931e;
      animation: blastExplode 0.7s ease-out forwards;
    }

    @keyframes blastExplode {
      0% { opacity: 1; transform: scale(0.3) rotate(0deg); }
      30% { transform: scale(2.5) rotate(45deg); }
      100% { opacity: 0; transform: scale(0.5) rotate(90deg); }
    }

    /* Void attack */
    .void-particle {
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #c77dff 0%, #7b2cbf 60%, #240046 100%);
      border-radius: 50%;
      box-shadow: 0 0 8px #9d4edd;
      animation: voidWisp 0.5s ease-out forwards;
    }

    @keyframes voidWisp {
      0% { opacity: 1; transform: scale(1) rotate(0deg); }
      100% { opacity: 0; transform: scale(0.3) rotate(180deg) translateY(20px); }
    }

    /* Heal particles */
    .heal-particle {
      width: 8px;
      height: 8px;
      background: #58f858;
      border-radius: 50%;
      box-shadow: 0 0 10px #58f858, 0 0 20px #20b820;
      animation: healSparkle 0.8s ease-out forwards;
    }

    @keyframes healSparkle {
      0% { opacity: 0; transform: scale(0) translateY(20px); }
      30% { opacity: 1; transform: scale(1.5) translateY(10px); }
      100% { opacity: 0; transform: scale(0.5) translateY(-30px); }
    }

    /* Super heal */
    .super-heal-particle {
      width: 10px;
      height: 10px;
      background: linear-gradient(135deg, #ffd23f 0%, #f7931e 100%);
      border-radius: 2px;
      transform: rotate(45deg);
      box-shadow: 0 0 12px #ffd23f, 0 0 24px #f7931e;
      animation: superHealSparkle 1s ease-out forwards;
    }

    @keyframes superHealSparkle {
      0% { opacity: 0; transform: rotate(0deg) scale(0) translateY(30px); }
      40% { opacity: 1; transform: rotate(180deg) scale(1.2) translateY(0); }
      100% { opacity: 0; transform: rotate(360deg) scale(0) translateY(-40px); }
    }

    /* Max heal */
    .max-heal-particle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: maxHealBurst 1.2s ease-out forwards;
    }

    @keyframes maxHealBurst {
      0% { opacity: 0; transform: scale(0); }
      30% { opacity: 1; transform: scale(2); }
      100% { opacity: 0; transform: scale(0.5) translateY(-50px); }
    }

    /* Attack projectiles */
    .projectile {
      position: absolute;
      border-radius: 50%;
      z-index: 35;
      pointer-events: none;
    }

    /* EMBER - flickering teardrop flame */
    .projectile.ember {
      width: 14px;
      height: 20px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 30%, #ff6b35 70%, #cc3300 100%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow: 0 0 14px #ff6b35, 0 0 28px #f7931e;
      animation: emberFlicker 0.1s ease-in-out infinite;
    }

    @keyframes emberFlicker {
      0%, 100% { transform: scaleX(1) scaleY(1); }
      50% { transform: scaleX(0.85) scaleY(1.1); }
    }

    /* FLAMETHROWER - elongated fire stream */
    .projectile.flamethrower {
      width: 35px;
      height: 18px;
      background: linear-gradient(90deg, #cc3300 0%, #ff6b35 20%, #ffd23f 50%, #fff 80%, #ffd23f 100%);
      border-radius: 20% 80% 80% 20% / 50% 50% 50% 50%;
      box-shadow: 0 0 20px #ff6b35, 0 0 40px #f7931e, 0 -5px 30px #ffd23f;
      animation: flameStream 0.08s ease-in-out infinite;
    }

    @keyframes flameStream {
      0%, 100% { transform: scaleX(1) skewX(0deg); }
      25% { transform: scaleX(1.1) skewX(-3deg); }
      75% { transform: scaleX(0.95) skewX(3deg); }
    }

    /* SHADOW BALL - swirling dark energy */
    .projectile.shadow-ball {
      width: 24px;
      height: 24px;
      background: radial-gradient(circle at 30% 30%, #e0aaff 0%, #9d4edd 25%, #7b2cbf 50%, #3c096c 80%, #240046 100%);
      border-radius: 50%;
      box-shadow: 0 0 18px #9d4edd, 0 0 36px #7b2cbf, inset 0 0 10px #240046;
      animation: shadowSwirl 0.2s linear infinite;
    }

    @keyframes shadowSwirl {
      0% { transform: rotate(0deg); background-position: 0% 0%; }
      100% { transform: rotate(360deg); }
    }

    /* FIRE BLAST - explosive star shape */
    .projectile.fire-blast {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #fff 0%, #ffd23f 15%, #ff6b35 35%, #cc3300 60%, #660000 100%);
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      box-shadow: 0 0 40px #ff6b35, 0 0 80px #f7931e, 0 0 120px #cc3300;
      animation: fireBlastPulse 0.1s ease-in-out infinite;
    }

    @keyframes fireBlastPulse {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.15) rotate(18deg); }
    }

    .projectile.void {
      width: 18px;
      height: 18px;
      background: radial-gradient(circle, #c77dff 0%, #9d4edd 40%, #7b2cbf 70%, #240046 100%);
      box-shadow: 0 0 14px #9d4edd, 0 0 28px #7b2cbf;
    }

    .projectile.sludge {
      width: 20px;
      height: 18px;
      background: radial-gradient(ellipse, #98e898 0%, #6bcf6b 30%, #4a9f4a 60%, #2a6f2a 100%);
      box-shadow: 0 0 16px #6bcf6b, 0 0 32px #4a9f4a;
      border-radius: 60% 40% 50% 50%;
      animation: sludgeWobble 0.3s ease-in-out infinite;
    }

    @keyframes sludgeWobble {
      0%, 100% { transform: scaleX(1) scaleY(1); }
      50% { transform: scaleX(1.1) scaleY(0.9); }
    }

    /* Sludge particles */
    .sludge-particle {
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #98e898 0%, #4a9f4a 70%, #2a6f2a 100%);
      border-radius: 60% 40% 70% 30%;
      box-shadow: 0 0 10px #6bcf6b;
      animation: sludgeDrip 0.6s ease-out forwards;
    }

    @keyframes sludgeDrip {
      0% { opacity: 1; transform: scale(1) translateY(0); }
      100% { opacity: 0; transform: scale(0.5) translateY(25px); }
    }

    /* Screen splat overlay */
    .screen-splat {
      position: absolute;
      pointer-events: none;
      z-index: 48;
      opacity: 0;
    }

    .screen-splat.active {
      animation: splatFade 2s ease-out forwards;
    }

    @keyframes splatFade {
      0% { opacity: 0.9; }
      70% { opacity: 0.7; }
      100% { opacity: 0; }
    }

    .splat-blob {
      position: absolute;
      background: radial-gradient(ellipse, #6bcf6b 0%, #4a9f4a 50%, #2a6f2a 80%, transparent 100%);
      border-radius: 50% 40% 60% 50%;
      box-shadow: inset 0 -5px 15px rgba(0,0,0,0.3), 0 0 20px #6bcf6b;
    }

    .splat-drip {
      position: absolute;
      background: linear-gradient(180deg, #4a9f4a 0%, #2a6f2a 100%);
      border-radius: 50% 50% 40% 40%;
      animation: dripDown 2s ease-in forwards;
    }

    @keyframes dripDown {
      0% { transform: translateY(0) scaleY(1); }
      100% { transform: translateY(40px) scaleY(1.5); }
    }

    /* Damage number - BIGGER */
    .damage-num {
      position: absolute;
      font-family: 'Press Start 2P', cursive;
      font-size: 18px;
      color: #fff;
      text-shadow: 3px 3px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
      z-index: 40;
      animation: damageFloat 1s ease-out forwards;
      pointer-events: none;
    }

    .damage-num.crit {
      font-size: 24px;
      color: #ff6b35;
    }

    .damage-num.heal {
      color: #58f858;
    }

    @keyframes damageFloat {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      20% { transform: translateY(-10px) scale(1.3); }
      100% { opacity: 0; transform: translateY(-40px) scale(1); }
    }

    /* Impact flash overlay */
    .impact-flash {
      position: absolute;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 49;
    }

    .impact-flash.active {
      animation: impactFlash 0.15s ease-out;
    }

    @keyframes impactFlash {
      0% { opacity: 0.7; }
      100% { opacity: 0; }
    }

    /* Footer links - BIGGER */
    .footer {
      text-align: center;
      margin-top: 0.6rem;
    }

    .x-link {
      font-size: 10px;
      color: rgba(255,255,255,0.75);
      text-decoration: none;
      transition: color 0.2s;
    }

    .x-link:hover { color: #fff; }

    .link-divider {
      color: rgba(255,255,255,0.4);
      margin: 0 12px;
      font-size: 10px;
    }

    /* Power LED */
    .power-led {
      position: absolute;
      bottom: 0.9rem;
      left: 1.2rem;
      width: 8px;
      height: 8px;
      background: #58f858;
      border-radius: 50%;
      box-shadow: 0 0 8px #58f858;
      animation: ledPulse 2s ease-in-out infinite;
    }

    @keyframes ledPulse {
      0%, 100% { box-shadow: 0 0 8px #58f858; }
      50% { box-shadow: 0 0 15px #58f858, 0 0 25px #20b820; }
    }

    @media (max-width: 450px) {
      .gameboy-shell { padding: 0.8rem 0.5rem 1.5rem 0.5rem; }
      .stat-name { font-size: 11px; }
      .stat-level { font-size: 10px; }
      .message-text { font-size: 13px; }
      .action-btn { font-size: 11px; }
      .move-btn { font-size: 10px; }
      .item-btn { font-size: 10px; }
      .flame-sprite { transform: scale(5); }
      .void-sprite { transform: scale(4.5); }
    }
  </style>
</head>
<body>
  <div class="gameboy-shell">
    <div class="gameboy-label">GAME BOY <span>COLOR</span></div>
    <div class="screen-bezel">
      <div class="viewport" id="viewport">
        <div class="impact-flash" id="impact-flash"></div>

        <!-- Enemy HP box - top left -->
        <div class="stat-box enemy">
          <div class="stat-row">
            <span class="stat-name">SPECTER</span>
            <span class="stat-level">50</span>
          </div>
          <div class="hp-row">
            <span class="hp-label">HP</span>
            <div class="hp-bar-bg">
              <div class="hp-bar-inner" id="enemy-hp" style="width: 100%"></div>
            </div>
          </div>
        </div>

        <!-- Player HP box - bottom right -->
        <div class="stat-box player">
          <div class="stat-row">
            <span class="stat-name">BAGUETTE</span>
            <span class="stat-level">50</span>
          </div>
          <div class="hp-row">
            <span class="hp-label">HP</span>
            <div class="hp-bar-bg">
              <div class="hp-bar-inner" id="player-hp" style="width: 100%"></div>
            </div>
          </div>
          <div class="hp-numbers"><span id="player-hp-num">100</span>/ 100</div>
          <div class="exp-bar-bg" style="margin-top: 4px;">
            <div class="exp-bar-inner" id="exp-bar" style="width: 0%"></div>
          </div>
        </div>

        <!-- Battle arena -->
        <div class="battle-arena">
          <div class="platform-enemy"></div>
          <div class="platform-player"></div>

          <!-- Enemy creature -->
          <div class="creature creature-enemy" id="enemy-creature">
            <div class="void-sprite">
              <div class="pixel-sprite"></div>
            </div>
          </div>

          <!-- Player creature -->
          <div class="creature creature-player" id="player-creature">
            <div class="flame-sprite">
              <div class="pixel-sprite"></div>
            </div>
          </div>
        </div>

        <!-- Main battle panel -->
        <div class="battle-panel" id="main-panel">
          <div class="message-box">
            <div class="message-text" id="battle-message">What will<br>BAGUETTE do?</div>
          </div>
          <div class="action-box">
            <div class="action-btn" data-action="fight">FIGHT</div>
            <div class="action-btn" data-action="bag">BAG</div>
            <div class="action-btn" data-action="pokemon">PKMN</div>
            <div class="action-btn" data-action="run">RUN</div>
          </div>
        </div>

        <!-- Fight panel -->
        <div class="fight-panel" id="fight-panel">
          <div class="moves-box">
            <div class="move-btn" data-move="ember">EMBER</div>
            <div class="move-btn" data-move="flamethrower">FLAMETHWR</div>
            <div class="move-btn" data-move="shadow-ball">SHADOWBALL</div>
            <div class="move-btn" data-move="fire-blast">FIREBLAST</div>
          </div>
          <div class="move-info">
            <div id="move-type">TYPE/FIRE</div>
            <div id="move-pp">PP 25/25</div>
          </div>
        </div>

        <!-- Items panel -->
        <div class="items-panel" id="items-panel">
          <div class="items-list">
            <div class="item-btn" data-item="potion">POTION<span class="item-count">x3</span></div>
            <div class="item-btn" data-item="super-potion">SUPERPOTION<span class="item-count">x2</span></div>
            <div class="item-btn" data-item="max-potion">MAXPOTION<span class="item-count">x1</span></div>
            <div class="item-btn" data-item="cancel">BACK</div>
          </div>
          <div class="move-info">
            <div>Use on<br>BAGUETTE?</div>
          </div>
        </div>
      </div>
    </div>
    <div class="power-led"></div>
    <div class="footer">
      <a href="mailto:hello@baguette.art" class="x-link">hello@baguette.art</a>
      <span class="link-divider">/</span>
      <a href="https://x.com/baguetteanon" target="_blank" rel="noopener" class="x-link">@baguetteanon</a>
    </div>
  </div>

  <script>
    const viewport = document.getElementById('viewport');
    const enemyHpBar = document.getElementById('enemy-hp');
    const playerHpBar = document.getElementById('player-hp');
    const playerHpNum = document.getElementById('player-hp-num');
    const battleMessage = document.getElementById('battle-message');
    const mainPanel = document.getElementById('main-panel');
    const fightPanel = document.getElementById('fight-panel');
    const itemsPanel = document.getElementById('items-panel');
    const playerCreature = document.getElementById('player-creature');
    const enemyCreature = document.getElementById('enemy-creature');
    const impactFlash = document.getElementById('impact-flash');

    let playerHp = 100;
    let enemyHp = 100;
    let playerLevel = 50;
    let playerExp = 0;
    let currentMenu = 'main';
    let isAnimating = false;
    let currentEnemy = 0;

    const enemies = [
      { name: 'SPECTER', level: 50, hp: 100, maxHp: 100, exp: 150, sprite: 'void', attack: 'SHADOW SNEAK', damage: [10, 18] },
      { name: 'SLIME', level: 52, hp: 120, maxHp: 120, exp: 180, sprite: 'slime', attack: 'SLUDGE BOMB', damage: [12, 20] }
    ];

    const moves = {
      'ember': { pp: 25, maxPp: 25, type: 'FIRE', power: 15, particles: 'ember' },
      'flamethrower': { pp: 15, maxPp: 15, type: 'FIRE', power: 25, particles: 'flamethrower' },
      'shadow-ball': { pp: 15, maxPp: 15, type: 'GHOST', power: 20, particles: 'shadow' },
      'fire-blast': { pp: 5, maxPp: 5, type: 'FIRE', power: 35, particles: 'blast' }
    };

    const items = {
      'potion': { count: 3, heal: 20, particles: 'heal' },
      'super-potion': { count: 2, heal: 50, particles: 'super-heal' },
      'max-potion': { count: 1, heal: 100, particles: 'max-heal' }
    };

    // Particle system
    function spawnParticle(type, x, y, extraStyles = {}) {
      const p = document.createElement('div');
      p.className = `particle ${type}-particle`;
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      Object.assign(p.style, extraStyles);
      viewport.appendChild(p);
      setTimeout(() => p.remove(), 1200);
    }

    function spawnParticleBurst(type, x, y, count, spread) {
      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2 / count) * i;
        const dist = spread * (0.5 + Math.random() * 0.5);
        const px = x + Math.cos(angle) * dist;
        const py = y + Math.sin(angle) * dist;
        const delay = Math.random() * 100;
        setTimeout(() => spawnParticle(type, px, py, {
          '--dx': (Math.random() - 0.5) * 40 + 'px'
        }), delay);
      }
    }

    function spawnHealParticles(type, targetEl, count) {
      const rect = targetEl.getBoundingClientRect();
      const viewRect = viewport.getBoundingClientRect();
      const cx = rect.left - viewRect.left + rect.width / 2;
      const cy = rect.top - viewRect.top + rect.height / 2;

      for (let i = 0; i < count; i++) {
        const delay = i * 80;
        const x = cx + (Math.random() - 0.5) * 60;
        const y = cy + (Math.random() - 0.5) * 60;
        setTimeout(() => {
          if (type === 'max-heal') {
            const hue = (i / count) * 360;
            spawnParticle(type, x, y, {
              background: `hsl(${hue}, 100%, 60%)`,
              boxShadow: `0 0 15px hsl(${hue}, 100%, 70%)`
            });
          } else {
            spawnParticle(type, x, y);
          }
        }, delay);
      }
    }

    function screenShake() {
      viewport.classList.add('shake');
      setTimeout(() => viewport.classList.remove('shake'), 300);
    }

    function triggerImpactFlash() {
      impactFlash.classList.remove('active');
      void impactFlash.offsetWidth;
      impactFlash.classList.add('active');
    }

    function createScreenSplat() {
      const splat = document.createElement('div');
      splat.className = 'screen-splat';

      // Create random splat blobs
      for (let i = 0; i < 5; i++) {
        const blob = document.createElement('div');
        blob.className = 'splat-blob';
        const size = 30 + Math.random() * 50;
        blob.style.width = size + 'px';
        blob.style.height = size * (0.6 + Math.random() * 0.4) + 'px';
        blob.style.left = (Math.random() * 80 + 10) + '%';
        blob.style.top = (Math.random() * 60 + 10) + '%';
        blob.style.transform = `rotate(${Math.random() * 360}deg)`;
        splat.appendChild(blob);

        // Add drips
        const dripCount = Math.floor(Math.random() * 3) + 1;
        for (let j = 0; j < dripCount; j++) {
          const drip = document.createElement('div');
          drip.className = 'splat-drip';
          drip.style.width = (4 + Math.random() * 6) + 'px';
          drip.style.height = (15 + Math.random() * 20) + 'px';
          drip.style.left = (parseFloat(blob.style.left) + Math.random() * 10 - 5) + '%';
          drip.style.top = (parseFloat(blob.style.top) + size * 0.3 / 5) + '%';
          drip.style.animationDelay = (Math.random() * 0.3) + 's';
          splat.appendChild(drip);
        }
      }

      viewport.appendChild(splat);
      splat.classList.add('active');
      setTimeout(() => splat.remove(), 2500);
    }

    function showMenu(menu) {
      if (isAnimating) return;
      currentMenu = menu;
      mainPanel.style.display = menu === 'main' ? 'flex' : 'none';
      fightPanel.classList.toggle('active', menu === 'fight');
      itemsPanel.classList.toggle('active', menu === 'items');
    }

    function updateHpBar(bar, hp, isPlayer) {
      bar.style.width = hp + '%';
      bar.classList.remove('medium', 'low');
      if (hp <= 20) bar.classList.add('low');
      else if (hp <= 50) bar.classList.add('medium');
      if (isPlayer) playerHpNum.textContent = Math.max(0, Math.round(hp));
    }

    function showMessage(msg) {
      battleMessage.innerHTML = msg;
    }

    function createProjectile(fromX, fromY, toX, toY, type, onHit) {
      const proj = document.createElement('div');
      proj.className = `projectile ${type}`;
      proj.style.left = fromX + 'px';
      proj.style.top = fromY + 'px';
      viewport.appendChild(proj);

      // Trail particles
      const trailInterval = setInterval(() => {
        const currentX = parseFloat(proj.style.left);
        const currentY = parseFloat(proj.style.top);
        if (type === 'void') {
          spawnParticle('void', currentX, currentY);
        } else if (type === 'shadow-ball') {
          spawnParticle('shadow', currentX, currentY);
        } else if (type === 'sludge') {
          spawnParticle('sludge', currentX + (Math.random() - 0.5) * 12, currentY + (Math.random() - 0.5) * 12);
        } else {
          spawnParticle('fire', currentX + (Math.random() - 0.5) * 10, currentY + (Math.random() - 0.5) * 10);
        }
      }, 50);

      const duration = type === 'fire-blast' ? 400 : 300;
      const startTime = Date.now();

      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);

        proj.style.left = fromX + (toX - fromX) * eased + 'px';
        proj.style.top = fromY + (toY - fromY) * eased + 'px';

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          clearInterval(trailInterval);
          proj.remove();
          if (onHit) onHit();
        }
      }
      animate();
    }

    function showDamage(x, y, amount, isCrit = false, isHeal = false) {
      const dmg = document.createElement('div');
      dmg.className = 'damage-num' + (isCrit ? ' crit' : '') + (isHeal ? ' heal' : '');
      dmg.textContent = (isHeal ? '+' : '') + amount;
      dmg.style.left = x + 'px';
      dmg.style.top = y + 'px';
      viewport.appendChild(dmg);
      setTimeout(() => dmg.remove(), 1000);
    }

    function hitCreature(creature) {
      creature.classList.add('hit');
      setTimeout(() => creature.classList.remove('hit'), 400);
    }

    function useMove(moveName) {
      if (isAnimating) return;
      const move = moves[moveName];
      if (!move || move.pp <= 0) return;

      isAnimating = true;
      move.pp--;
      // Update PP display
      document.getElementById('move-pp').textContent = `PP ${move.pp}/${move.maxPp}`;
      const displayName = moveName.replace('-', ' ').toUpperCase();
      showMessage(`BAGUETTE used<br>${displayName}!`);
      showMenu('main');

      const playerRect = playerCreature.getBoundingClientRect();
      const enemyRect = enemyCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();

      const fromX = playerRect.left - viewportRect.left + playerRect.width / 2;
      const fromY = playerRect.top - viewportRect.top + playerRect.height / 2;
      const toX = enemyRect.left - viewportRect.left + enemyRect.width / 2;
      const toY = enemyRect.top - viewportRect.top + enemyRect.height / 2;

      // Charge up particles
      setTimeout(() => {
        spawnParticleBurst('ember', fromX, fromY, 8, 30);
      }, 200);

      setTimeout(() => {
        createProjectile(fromX, fromY, toX, toY, moveName, () => {
          hitCreature(enemyCreature);
          screenShake();
          triggerImpactFlash();

          const isCrit = Math.random() < 0.15;
          const isMega = playerCreature.querySelector('div').classList.contains('mega-flame-sprite');
          const megaBonus = isMega ? 200 : 0; // MEGA BAGUETTE one-shots!
          const damage = move.power + Math.floor(Math.random() * 10) + (isCrit ? 15 : 0) + megaBonus;
          enemyHp = Math.max(0, enemyHp - damage);
          updateHpBar(enemyHpBar, enemyHp, false);
          showDamage(toX, toY - 30, damage, isCrit);

          // Impact particles based on move type
          if (move.particles === 'blast') {
            spawnParticleBurst('blast', toX, toY, 12, 50);
            spawnParticleBurst('fire', toX, toY, 20, 70);
          } else if (move.particles === 'flamethrower') {
            spawnParticleBurst('flame-stream', toX, toY, 10, 40);
          } else if (move.particles === 'shadow') {
            spawnParticleBurst('shadow', toX, toY, 15, 45);
          } else {
            spawnParticleBurst('ember', toX, toY, 8, 35);
          }

          if (enemyHp <= 0) {
            const enemy = enemies[currentEnemy];
            showMessage(`Wild ${enemy.name}<br>fainted!`);
            enemyCreature.classList.add('fainting');

            setTimeout(() => {
              // Award EXP
              const expGain = enemy.exp;
              showMessage(`BAGUETTE gained<br>${expGain} EXP!`);
              playerExp += expGain;
              const expPercent = Math.min(100, (playerExp % 300) / 3);
              document.getElementById('exp-bar').style.width = expPercent + '%';

              // Level up check
              if (playerExp >= 300) {
                setTimeout(() => {
                  playerExp = playerExp % 300;
                  playerLevel++;
                  showMessage(`BAGUETTE grew to<br>Lv${playerLevel}!`);
                  document.querySelector('.stat-box.player .stat-level').textContent = playerLevel;
                  spawnHealParticles('max-heal', playerCreature, 15);
                }, 1500);
              }

              setTimeout(() => {
                // Check for next enemy
                if (currentEnemy < enemies.length - 1) {
                  currentEnemy++;
                  const nextEnemy = enemies[currentEnemy];
                  showMessage(`Trainer sends out<br>${nextEnemy.name}!`);

                  // Update enemy stats
                  document.querySelector('.stat-box.enemy .stat-name').textContent = nextEnemy.name;
                  document.querySelector('.stat-box.enemy .stat-level').textContent = nextEnemy.level;

                  // Swap sprite
                  const spriteContainer = enemyCreature.querySelector('div');
                  spriteContainer.className = nextEnemy.sprite + '-sprite';

                  enemyHp = nextEnemy.maxHp;
                  updateHpBar(enemyHpBar, 100, false);

                  enemyCreature.classList.remove('fainting');
                  enemyCreature.classList.add('appearing');

                  setTimeout(() => {
                    enemyCreature.classList.remove('appearing');
                    isAnimating = false;
                    showMessage('What will<br>BAGUETTE do?');
                  }, 1000);
                } else {
                  // All enemies defeated - Pokemon-style victory!
                  isAnimating = true;
                  const totalExp = enemies.reduce((sum, e) => sum + e.exp, 0);
                  const prizeMoney = 2400;
                  let hasEvolved = false;

                  // Victory fanfare sequence
                  setTimeout(() => {
                    showMessage('Player defeated<br>TRAINER GHOST!');
                  }, 500);

                  setTimeout(() => {
                    showMessage(`BAGUETTE gained<br>${totalExp} total EXP!`);
                    spawnHealParticles('heal', playerCreature, 8);
                  }, 2500);

                  setTimeout(() => {
                    showMessage(`Got $${prizeMoney}<br>for winning!`);
                    spawnHealParticles('super-heal', playerCreature, 12);
                  }, 4500);

                  // Evolution check - evolve after first victory
                  setTimeout(() => {
                    const playerSpriteContainer = playerCreature.querySelector('div');
                    if (!playerSpriteContainer.classList.contains('mega-flame-sprite')) {
                      hasEvolved = true;
                      showMessage('What?<br>BAGUETTE is evolving!');

                      // Start flashing
                      playerCreature.classList.add('evo-flashing');

                      // Get player sprite position for particles
                      const rect = playerCreature.getBoundingClientRect();
                      const vRect = viewport.getBoundingClientRect();
                      const cx = rect.left - vRect.left + rect.width / 2;
                      const cy = rect.top - vRect.top + rect.height / 2;

                      // Spawn tornado particles around player
                      const spawnTornado = () => {
                        for (let i = 0; i < 8; i++) {
                          setTimeout(() => {
                            const p = document.createElement('div');
                            p.className = 'evo-particle';
                            p.style.left = cx + 'px';
                            p.style.top = cy + 'px';
                            p.style.animation = `tornado-spin 1.5s ease-in-out forwards`;
                            p.style.animationDelay = (i * 0.1) + 's';
                            viewport.appendChild(p);
                            setTimeout(() => p.remove(), 2000);
                          }, i * 60);
                        }
                      };
                      spawnTornado();
                      setTimeout(spawnTornado, 600);
                      setTimeout(spawnTornado, 1200);
                      setTimeout(spawnTornado, 1800);
                    }
                  }, 6500);

                  // Swap to mega form
                  setTimeout(() => {
                    if (hasEvolved) {
                      const playerSpriteContainer = playerCreature.querySelector('div');
                      playerSpriteContainer.className = 'mega-flame-sprite';
                    }
                  }, 9500);

                  // Evolution complete
                  setTimeout(() => {
                    if (hasEvolved) {
                      playerCreature.classList.remove('evo-flashing');
                      showMessage('Congratulations!<br>BAGUETTE evolved<br>into MEGA BAGUETTE!');
                      document.querySelector('.stat-box.player .stat-name').textContent = 'MEGA BAGUETTE';
                      spawnHealParticles('super-heal', playerCreature, 20);
                    }
                  }, 11000);

                  setTimeout(() => {
                    showMessage('Want to battle<br>again? TAP!');

                    // Reset for replay
                    currentEnemy = 0;
                    const firstEnemy = enemies[0];
                    document.querySelector('.stat-box.enemy .stat-name').textContent = firstEnemy.name;
                    document.querySelector('.stat-box.enemy .stat-level').textContent = firstEnemy.level;
                    const spriteContainer = enemyCreature.querySelector('div');
                    spriteContainer.className = firstEnemy.sprite + '-sprite';
                    enemyCreature.classList.remove('fainting');

                    // Reset PP
                    Object.values(moves).forEach(m => m.pp = m.maxPp);

                    viewport.onclick = () => {
                      viewport.onclick = null;
                      enemyHp = firstEnemy.maxHp;
                      playerHp = 100;
                      updateHpBar(enemyHpBar, 100, false);
                      updateHpBar(playerHpBar, 100, true);
                      isAnimating = false;
                      showMessage('TRAINER GHOST<br>wants to battle!');
                      setTimeout(() => {
                        showMessage(`TRAINER GHOST<br>sent out ${firstEnemy.name}!`);
                        enemyCreature.classList.add('appearing');
                        setTimeout(() => {
                          enemyCreature.classList.remove('appearing');
                          showMessage('What will<br>BAGUETTE do?');
                        }, 800);
                      }, 1500);
                    };
                  }, 13000);
                }
              }, playerExp >= 300 ? 3500 : 2000);
            }, 1000);
          } else {
            setTimeout(() => {
              isAnimating = false;
              enemyAttack();
            }, 800);
          }
        });
      }, 500);
    }

    function enemyAttack() {
      isAnimating = true;
      const enemy = enemies[currentEnemy];
      showMessage(`Wild ${enemy.name}<br>used ${enemy.attack}!`);

      const playerRect = playerCreature.getBoundingClientRect();
      const enemyRect = enemyCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();

      const fromX = enemyRect.left - viewportRect.left + enemyRect.width / 2;
      const fromY = enemyRect.top - viewportRect.top + enemyRect.height / 2;
      const toX = playerRect.left - viewportRect.left + playerRect.width / 2;
      const toY = playerRect.top - viewportRect.top + playerRect.height / 2;

      // Enemy charge particles
      setTimeout(() => {
        spawnParticleBurst('void', fromX, fromY, 6, 25);
      }, 200);

      setTimeout(() => {
        const projType = enemy.sprite === 'slime' ? 'sludge' : 'void';
        const particleType = enemy.sprite === 'slime' ? 'sludge' : 'void';

        createProjectile(fromX, fromY, toX, toY, projType, () => {
          hitCreature(playerCreature);
          screenShake();
          triggerImpactFlash();

          const damage = enemy.damage[0] + Math.floor(Math.random() * (enemy.damage[1] - enemy.damage[0]));
          playerHp = Math.max(0, playerHp - damage);
          updateHpBar(playerHpBar, playerHp, true);
          showDamage(toX, toY - 30, damage);
          spawnParticleBurst(particleType, toX, toY, 10, 40);

          // Screen splat for sludge attacks
          if (particleType === 'sludge') {
            createScreenSplat();
          }

          if (playerHp <= 15 && playerHp > 0) {
            isAnimating = false;
            setTimeout(() => useMaxPotion(), 800);
          } else if (playerHp <= 0) {
            showMessage('BAGUETTE<br>fainted!');
            isAnimating = false;
            setTimeout(() => {
              playerHp = 100;
              updateHpBar(playerHpBar, 100, true);
              showMessage('BAGUETTE woke up!');
              setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1500);
            }, 2000);
          } else {
            isAnimating = false;
            setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1000);
          }
        });
      }, 500);
    }

    function useMaxPotion() {
      isAnimating = true;
      showMessage('BAGUETTE used<br>MAX POTION!');

      const playerRect = playerCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();
      const cx = playerRect.left - viewportRect.left + playerRect.width / 2;
      const cy = playerRect.top - viewportRect.top + playerRect.height / 2;

      setTimeout(() => {
        spawnHealParticles('max-heal', playerCreature, 20);
        playerHp = 100;
        updateHpBar(playerHpBar, 100, true);
        showDamage(cx, cy - 30, 100, false, true);
        showMessage("BAGUETTE's HP<br>was restored!");
        isAnimating = false;
        setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1500);
      }, 500);
    }

    function useItem(itemName) {
      if (isAnimating) return;
      const item = items[itemName];
      if (!item || item.count <= 0) return;

      isAnimating = true;
      item.count--;
      const btn = document.querySelector(`[data-item="${itemName}"]`);
      if (btn) btn.querySelector('.item-count').textContent = `x${item.count}`;

      const displayName = itemName.toUpperCase().replace('-', ' ');
      showMessage(`BAGUETTE used<br>${displayName}!`);
      showMenu('main');

      const playerRect = playerCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();
      const cx = playerRect.left - viewportRect.left + playerRect.width / 2;
      const cy = playerRect.top - viewportRect.top + playerRect.height / 2;

      setTimeout(() => {
        const healAmount = Math.min(item.heal, 100 - playerHp);
        playerHp = Math.min(100, playerHp + item.heal);
        updateHpBar(playerHpBar, playerHp, true);

        // Different particles for different potions
        if (item.particles === 'max-heal') {
          spawnHealParticles('max-heal', playerCreature, 20);
        } else if (item.particles === 'super-heal') {
          spawnHealParticles('super-heal', playerCreature, 15);
        } else {
          spawnHealParticles('heal', playerCreature, 10);
        }

        showDamage(cx, cy - 30, healAmount, false, true);
        showMessage(`Restored<br>${healAmount} HP!`);

        isAnimating = false;
        setTimeout(() => enemyAttack(), 1000);
      }, 800);
    }

    // Event listeners
    document.querySelectorAll('.action-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (isAnimating) return;
        const action = btn.dataset.action;
        if (action === 'fight') showMenu('fight');
        else if (action === 'bag') showMenu('items');
        else if (action === 'run') {
          showMessage("Can't escape!");
          setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1500);
        }
        else if (action === 'pokemon') {
          showMessage('BAGUETTE is<br>already out!');
          setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1500);
        }
      });
    });

    document.querySelectorAll('.move-btn').forEach(btn => {
      btn.addEventListener('click', () => useMove(btn.dataset.move));
      btn.addEventListener('mouseenter', () => {
        const move = moves[btn.dataset.move];
        if (move) {
          document.getElementById('move-type').textContent = `TYPE/${move.type}`;
          document.getElementById('move-pp').textContent = `PP ${move.pp}/${move.maxPp}`;
        }
      });
    });

    document.querySelectorAll('.item-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.dataset.item === 'cancel') showMenu('main');
        else useItem(btn.dataset.item);
      });
    });

    // Tap creatures
    playerCreature.addEventListener('click', () => {
      if (currentMenu === 'main' && !isAnimating) showMenu('fight');
    });

    enemyCreature.addEventListener('click', () => {
      if (currentMenu === 'main' && !isAnimating) {
        showMessage('Wild SPECTER<br>looks angry!');
        spawnParticleBurst('void',
          enemyCreature.getBoundingClientRect().left - viewport.getBoundingClientRect().left + 40,
          enemyCreature.getBoundingClientRect().top - viewport.getBoundingClientRect().top + 40,
          6, 30);
        setTimeout(() => showMessage('What will<br>BAGUETTE do?'), 1500);
      }
    });
  </script>
</body>
</html>
