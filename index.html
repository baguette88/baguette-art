<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Baguette</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-dark: #0d0d12;
      --void-core: #7b2cbf;
      --void-mid: #9d4edd;
      --flame-core: #ff6b35;
      --flame-mid: #f7931e;
    }

    html, body {
      height: 100%;
      width: 100%;
      background: #2c2c3a;
      font-family: 'Press Start 2P', cursive;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .gameboy-shell {
      background: linear-gradient(145deg, #7b6ba5 0%, #6b5b95 30%, #5a4a84 70%, #4a3a74 100%);
      padding: 1.4rem 1rem 0.5rem 1rem;
      border-radius: 12px 12px 45px 45px;
      box-shadow:
        inset 0 2px 4px rgba(255,255,255,0.3),
        inset 0 -2px 6px rgba(0,0,0,0.3),
        0 12px 50px rgba(0,0,0,0.6),
        0 0 0 3px #3a2a54;
      position: relative;
    }

    /* Shell ridge details */
    .gameboy-shell::before {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      height: 4px;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 20%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.1) 80%, transparent 100%);
      border-radius: 2px;
    }

    /* Mode switch - top of shell */
    .mode-switch-container {
      position: absolute;
      top: -12px;
      left: 15px;
      display: flex;
      align-items: center;
      gap: 6px;
      z-index: 100;
    }

    .mode-label {
      font-size: 6px;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.5px;
    }

    .mode-label.active {
      color: rgba(255,255,255,0.9);
    }

    .power-switch {
      width: 36px;
      height: 16px;
      background: linear-gradient(180deg, #2a2a3a 0%, #1a1a2a 50%, #0a0a1a 100%);
      border-radius: 3px;
      cursor: pointer;
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.8),
        0 1px 0 rgba(255,255,255,0.1);
      position: relative;
    }

    .power-switch::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 14px;
      height: 12px;
      background: linear-gradient(180deg, #707080 0%, #505060 50%, #404050 100%);
      border-radius: 2px;
      transition: left 0.15s ease-out;
      box-shadow:
        inset 0 1px 1px rgba(255,255,255,0.4),
        0 1px 2px rgba(0,0,0,0.5);
    }

    .power-switch.on::before {
      left: 20px;
    }

    .gameboy-shell.dmg-mode .mode-label.left { color: rgba(80,80,72,0.9); }
    .gameboy-shell.dmg-mode .mode-label.right { color: rgba(80,80,72,0.5); }
    .gameboy-shell:not(.dmg-mode) .mode-label.left { color: rgba(255,255,255,0.5); }
    .gameboy-shell:not(.dmg-mode) .mode-label.right { color: rgba(255,255,255,0.9); }

    .gameboy-shell.dmg-mode .power-switch {
      background: linear-gradient(180deg, #606058 0%, #505048 50%, #404038 100%);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.2);
    }

    .gameboy-shell.dmg-mode .power-switch::before {
      background: linear-gradient(180deg, #a0a098 0%, #888880 50%, #707068 100%);
    }

    .gameboy-shell.dmg-mode .mode-switch-container .mode-label {
      color: rgba(80,80,72,0.6);
    }

    .gameboy-header {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.3rem;
      padding-top: 0.2rem;
    }

    .gameboy-label {
      font-size: 8px;
      color: rgba(255,255,255,0.8);
      white-space: nowrap;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .gameboy-label span {
      background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff, #9d65c9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* DMG Mode - Classic grey Game Boy (blockier, squared design) */
    .gameboy-shell.dmg-mode {
      background: linear-gradient(180deg, #d4d4c8 0%, #c8c8bc 15%, #bcbcb0 50%, #b0b0a4 85%, #a0a094 100%);
      border-radius: 8px 8px 20px 20px;
      box-shadow:
        inset 0 2px 4px rgba(255,255,255,0.6),
        inset -2px 0 3px rgba(0,0,0,0.1),
        inset 2px 0 3px rgba(0,0,0,0.1),
        inset 0 -3px 6px rgba(0,0,0,0.15),
        0 12px 50px rgba(0,0,0,0.5),
        0 0 0 2px #909088;
      padding: 1.6rem 1.2rem 0.5rem 1.2rem;
    }

    /* DMG has vertical lines/ridges on sides */
    .gameboy-shell.dmg-mode::before {
      content: '';
      position: absolute;
      top: 60px;
      left: 6px;
      width: 6px;
      height: calc(100% - 100px);
      background: repeating-linear-gradient(180deg,
        #b8b8ac 0px, #b8b8ac 3px,
        #a8a89c 3px, #a8a89c 6px);
      border-radius: 2px;
    }

    .gameboy-shell.dmg-mode .power-switch {
      background: linear-gradient(180deg, #808078 0%, #707068 50%, #606058 100%);
      border-radius: 3px 3px 1px 1px;
    }

    .gameboy-shell.dmg-mode .power-switch::before {
      background: linear-gradient(180deg, #a0a098 0%, #909088 100%);
    }

    .gameboy-shell.dmg-mode .power-switch.on::before {
      background: linear-gradient(180deg, #c84040 0%, #a83030 100%);
    }

    .gameboy-shell.dmg-mode .gameboy-label {
      color: #505048;
      font-size: 9px;
      letter-spacing: 2px;
      text-shadow: 0 1px 1px rgba(255,255,255,0.6);
    }

    .gameboy-shell.dmg-mode .gameboy-label span {
      background: none;
      -webkit-text-fill-color: #404038;
      color: #404038;
    }

    .gameboy-shell.dmg-mode .viewport {
      filter: sepia(100%) hue-rotate(50deg) saturate(60%) brightness(90%) contrast(110%);
      background: linear-gradient(180deg, #8bac0f 0%, #9bbc0f 30%, #306230 60%, #0f380f 100%);
      border-radius: 2px;
      margin-top: 10px;
    }

    .gameboy-shell.dmg-mode .screen-bezel {
      background: linear-gradient(180deg, #505048 0%, #606058 100%);
      box-shadow: inset 0 4px 12px rgba(0,0,0,0.7);
      border-radius: 8px 8px 8px 20px;
      padding: 0.6rem;
      position: relative;
    }

    .gameboy-shell.dmg-mode .screen-bezel::before {
      content: 'DOT MATRIX WITH STEREO SOUND';
      position: absolute;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 4px;
      color: #808078;
      letter-spacing: 1px;
      white-space: nowrap;
      font-weight: normal;
      z-index: 5;
    }

    .gameboy-shell.dmg-mode .power-led {
      background: #cc3030;
      box-shadow: 0 0 8px #ff4040;
      width: 6px;
      height: 6px;
    }

    /* Battery label for DMG */
    .battery-label {
      display: none;
    }

    .gameboy-shell.dmg-mode .battery-label {
      display: block;
      position: absolute;
      top: 6px;
      left: 88px;
      font-size: 4px;
      color: #707068;
      letter-spacing: 0.5px;
    }

    /* Nintendo GAME BOY brand below screen for DMG */
    .dmg-brand {
      display: none;
    }

    .gameboy-shell.dmg-mode .dmg-brand {
      display: block;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 8px;
      text-align: center;
    }

    .gameboy-shell.dmg-mode .dmg-brand .nintendo-text {
      font-size: 6px;
      color: #2a2a28;
      letter-spacing: 3px;
      margin-bottom: 2px;
    }

    .gameboy-shell.dmg-mode .dmg-brand .gameboy-text {
      font-size: 11px;
      color: #1a1a18;
      letter-spacing: 1px;
      font-weight: bold;
    }

    .gameboy-shell.dmg-mode .dmg-brand .tm-text {
      font-size: 5px;
      vertical-align: super;
      color: #3a3a38;
    }

    /* Hide GBC header label in DMG mode */
    .gameboy-shell.dmg-mode .gameboy-header {
      visibility: hidden;
      height: 0;
      margin: 0;
      padding: 0;
    }

    .screen-bezel {
      background: #1a1a24;
      padding: 0.5rem;
      border-radius: 8px;
      box-shadow: inset 0 4px 12px rgba(0,0,0,0.8);
      position: relative;
    }

    .viewport {
      width: min(88vw, 88vh, 500px);
      height: min(88vw, 88vh, 500px);
      background: linear-gradient(180deg, #88c8e8 0%, #78b8d8 30%, #98d868 60%, #78b858 100%);
      border-radius: 3px;
      position: relative;
      overflow: hidden;
      image-rendering: pixelated;
    }

    .viewport.shake {
      animation: screenShake 0.3s ease-out;
    }

    @keyframes screenShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-3px); }
      80% { transform: translateX(3px); }
    }

    /* Mode switch shader transition - DMG to Color (warm colorization) */
    .viewport.mode-transition-color {
      animation: colorWarm 0.6s ease-out;
    }

    @keyframes colorWarm {
      0% {
        filter: brightness(1) saturate(0) sepia(0.3);
      }
      30% {
        filter: brightness(1.05) saturate(0.4) sepia(0.2);
      }
      60% {
        filter: brightness(1.02) saturate(0.8) sepia(0.05);
      }
      100% {
        filter: brightness(1) saturate(1) sepia(0);
      }
    }

    /* Warm glow overlay during colorization */
    .viewport.mode-transition-color::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(255,248,220,0.25) 0%, rgba(255,220,180,0.1) 50%, transparent 80%);
      mix-blend-mode: overlay;
      animation: warmGlow 0.6s ease-out;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes warmGlow {
      0% { opacity: 0; }
      40% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Color drain shader - Game Boy LCD style */
    .viewport.mode-transition-drain {
      animation: lcdDrain 0.35s ease-in forwards;
    }

    @keyframes lcdDrain {
      0% {
        filter: brightness(1) saturate(1) contrast(1);
        clip-path: inset(0 0 0 0);
      }
      40% {
        filter: brightness(0.7) saturate(0.3) contrast(1.3);
        clip-path: inset(0 0 0 0);
      }
      70% {
        filter: brightness(0.4) saturate(0) contrast(1.5);
        clip-path: inset(20% 0 20% 0);
      }
      100% {
        filter: brightness(0.2) saturate(0) contrast(2);
        clip-path: inset(45% 0 45% 0);
      }
    }

    /* LCD pixel ghost overlay */
    .viewport.mode-transition-drain::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        180deg,
        rgba(0,50,0,0) 0%,
        rgba(0,50,0,0.3) 50%,
        rgba(0,50,0,0) 100%
      );
      animation: lcdGhost 0.35s ease-in;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes lcdGhost {
      0% { opacity: 0; transform: scaleY(1); }
      50% { opacity: 1; transform: scaleY(1); }
      100% { opacity: 0; transform: scaleY(0.1); }
    }

    /* Critical hit shader */
    .viewport.crit-flash {
      animation: critShader 0.25s ease-out;
    }

    @keyframes critShader {
      0% {
        filter: invert(0) brightness(1) contrast(1);
        transform: scale(1);
      }
      20% {
        filter: invert(1) brightness(1.5) contrast(1.5);
        transform: scale(1.04);
      }
      40% {
        filter: invert(0) brightness(2) contrast(1.2) saturate(2);
        transform: scale(0.98);
      }
      60% {
        filter: invert(0.3) brightness(1.3) contrast(1.3);
        transform: scale(1.02);
      }
      100% {
        filter: invert(0) brightness(1) contrast(1) saturate(1);
        transform: scale(1);
      }
    }

    /* Crit slash overlay */
    .viewport.crit-flash::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        transparent 40%,
        rgba(255,255,255,0.9) 48%,
        rgba(255,255,0,0.8) 50%,
        rgba(255,255,255,0.9) 52%,
        transparent 60%
      );
      animation: critSlash 0.25s ease-out;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes critSlash {
      0% { opacity: 0; transform: translateX(-100%) rotate(0deg); }
      30% { opacity: 1; }
      100% { opacity: 0; transform: translateX(100%) rotate(0deg); }
    }

    /* Scanlines */
    .viewport::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
      pointer-events: none;
      z-index: 50;
    }

    /* Pokemon-style HP boxes - FireRed layout */
    .stat-box {
      position: absolute;
      background: linear-gradient(180deg, #f8f0d8 0%, #e8e0c8 100%);
      border: 3px solid #484038;
      padding: 6px 10px;
      min-width: 44%;
      z-index: 20;
    }

    .stat-box.enemy {
      top: 2%;
      left: 2%;
      border-radius: 0 0 10px 0;
    }

    .stat-box.player {
      bottom: 34%;
      right: 2%;
      border-radius: 10px 0 0 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .stat-name {
      font-size: 14px;
      color: #303030;
      letter-spacing: -0.5px;
    }

    .stat-level {
      font-size: 12px;
      color: #303030;
    }

    .stat-level::before {
      content: 'Lv';
      font-size: 10px;
      margin-right: 2px;
    }

    .hp-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .hp-label {
      font-size: 10px;
      color: #f8a800;
      font-weight: bold;
    }

    .hp-bar-bg {
      flex: 1;
      height: 12px;
      background: #484038;
      border-radius: 6px;
      padding: 2px;
    }

    .hp-bar-inner {
      height: 100%;
      background: linear-gradient(180deg, #58f858 0%, #20b820 100%);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .hp-bar-inner.medium {
      background: linear-gradient(180deg, #f8d830 0%, #c8a820 100%);
    }

    .hp-bar-inner.low {
      background: linear-gradient(180deg, #f85858 0%, #c82020 100%);
    }

    .hp-numbers {
      text-align: right;
      font-size: 11px;
      color: #303030;
      margin-top: 4px;
    }

    /* Battle arena */
    .battle-arena {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 32%;
    }

    /* Ground platforms - Pokemon FireRed style */
    .platform-enemy {
      position: absolute;
      top: 32%;
      right: 8%;
      width: 35%;
      height: 12px;
      background: linear-gradient(180deg, #90b058 0%, #78a048 100%);
      border-radius: 50%;
      box-shadow: 0 4px 0 #608030;
    }

    .platform-player {
      position: absolute;
      bottom: 2%;
      left: 3%;
      width: 45%;
      height: 16px;
      background: linear-gradient(180deg, #90b058 0%, #78a048 100%);
      border-radius: 50%;
      box-shadow: 0 6px 0 #608030;
    }

    /* Pixel art creatures - FireRed positions */
    .creature {
      position: absolute;
      image-rendering: pixelated;
      z-index: 10;
    }

    .creature-enemy {
      top: 8%;
      right: 18%;
      transform: scaleX(-1);
    }

    .creature-player {
      bottom: 38%;
      left: 15%;
    }

    .pixel-sprite {
      width: 1px;
      height: 1px;
      transform-origin: center;
    }

    /* SWEETBUN - Starting form! Cute round bun */
    .sweetbun-sprite {
      transform: scale(5);
    }

    .sweetbun-sprite .pixel-sprite {
      box-shadow:
        /* SWEETBUN - Cute round glazed bun, upper-left light */
        /* Palette: Shadow #b87333 (copper) → Mid #e8a862 (honey) → Highlight #fff5e6 (cream) */

        /* Round bun body */
        7px 6px 0 #fff5e6, 8px 6px 0 #ffe8cc, 9px 6px 0 #f5d4a8,
        6px 7px 0 #fff5e6, 7px 7px 0 #ffe8cc, 8px 7px 0 #f5d4a8, 9px 7px 0 #e8a862, 10px 7px 0 #d4944a,
        5px 8px 0 #fff5e6, 6px 8px 0 #ffe8cc, 7px 8px 0 #f5d4a8, 8px 8px 0 #e8a862, 9px 8px 0 #d4944a, 10px 8px 0 #c07830, 11px 8px 0 #b87333,
        5px 9px 0 #ffe8cc, 6px 9px 0 #f5d4a8, 7px 9px 0 #e8a862, 8px 9px 0 #d4944a, 9px 9px 0 #c07830, 10px 9px 0 #b87333, 11px 9px 0 #a05a20,
        5px 10px 0 #f5d4a8, 6px 10px 0 #e8a862, 7px 10px 0 #d4944a, 8px 10px 0 #c07830, 9px 10px 0 #b87333, 10px 10px 0 #a05a20, 11px 10px 0 #8b4513,
        6px 11px 0 #d4944a, 7px 11px 0 #c07830, 8px 11px 0 #b87333, 9px 11px 0 #a05a20, 10px 11px 0 #8b4513,
        7px 12px 0 #a05a20, 8px 12px 0 #8b4513, 9px 12px 0 #704010,

        /* Sugar glaze drizzle on top */
        6px 6px 0 #ffffff, 8px 5px 0 #ffffff, 10px 6px 0 #fffaf0,
        7px 7px 0 #fffaf0, 9px 6px 0 #ffffff,

        /* Cute eyes with sparkle */
        6px 8px 0 #1a1a24, 7px 8px 0 #ffffff,
        9px 8px 0 #1a1a24, 10px 8px 0 #ffffff,

        /* Rosy cheeks */
        5px 9px 0 #ffb0a0, 11px 9px 0 #e09080,

        /* Happy little smile */
        7px 10px 0 #8b4513, 8px 10px 0 #704010, 9px 10px 0 #8b4513,

        /* Tiny feet */
        6px 13px 0 #8b4513, 7px 13px 0 #a05a20, 9px 13px 0 #704010, 10px 13px 0 #5c3010;
    }

    /* BAGUETTE - Evolved form with flames! */
    .flame-sprite {
      transform: scale(5);
    }

    .flame-sprite .pixel-sprite {
      box-shadow:
        /* BAGUETTE - Evolved form, upper-left light */
        /* Palette: Shadow #8B5A2B (sienna) → Mid #D4A574 (tan) → Highlight #FFF4D6 (cream) */

        /* Flame crown - light from upper-left */
        7px 3px 0 #fffbe8, 8px 2px 0 #fffbe8,
        6px 4px 0 #ffe066, 7px 4px 0 #fffbe8, 8px 3px 0 #fffbe8, 9px 4px 0 #ffc233,
        5px 5px 0 #ff9500, 6px 5px 0 #ffcc00, 7px 5px 0 #ffe066, 8px 4px 0 #ffe066, 9px 5px 0 #ffc233, 10px 5px 0 #ff7700,
        5px 6px 0 #cc4400, 6px 6px 0 #ff6600, 7px 6px 0 #ff9500, 8px 5px 0 #ffcc00, 9px 6px 0 #ff6600, 10px 6px 0 #cc4400,
        6px 7px 0 #991100, 7px 7px 0 #cc4400, 8px 6px 0 #ff6600, 9px 7px 0 #991100,

        /* Baguette body - upper-left highlight, bottom-right shadow */
        6px 8px 0 #fff4d6, 7px 8px 0 #ffe8b8, 8px 8px 0 #e8c097, 9px 8px 0 #d4a574, 10px 8px 0 #c99a65,
        5px 9px 0 #fff4d6, 6px 9px 0 #ffe8b8, 7px 9px 0 #e8c097, 8px 9px 0 #d4a574, 9px 9px 0 #c99a65, 10px 9px 0 #b8894f, 11px 9px 0 #a67c3d,
        5px 10px 0 #ffe8b8, 6px 10px 0 #e8c097, 7px 10px 0 #d4a574, 8px 10px 0 #c99a65, 9px 10px 0 #b8894f, 10px 10px 0 #a67c3d, 11px 10px 0 #8b5a2b,
        5px 11px 0 #e8c097, 6px 11px 0 #d4a574, 7px 11px 0 #c99a65, 8px 11px 0 #b8894f, 9px 11px 0 #a67c3d, 10px 11px 0 #8b5a2b, 11px 11px 0 #704214,
        6px 12px 0 #c99a65, 7px 12px 0 #b8894f, 8px 12px 0 #a67c3d, 9px 12px 0 #8b5a2b, 10px 12px 0 #704214,
        7px 13px 0 #8b5a2b, 8px 13px 0 #704214, 9px 13px 0 #5c3317,

        /* Eyes - clear focal point with catchlight */
        6px 9px 0 #1a1a24, 7px 9px 0 #ffffff, 9px 9px 0 #1a1a24, 10px 9px 0 #ffffff,
        6px 10px 0 #1a1a24, 9px 10px 0 #1a1a24,

        /* Blush - warm on lit side, cooler on shadow */
        5px 10px 0 #ffb8a8, 11px 10px 0 #e89888,

        /* Feet - grounded */
        6px 14px 0 #704214, 7px 14px 0 #8b5a2b, 9px 14px 0 #5c3317, 10px 14px 0 #4a2c0a;
    }

    /* MEGA BAGUETTE - Final form! Bigger, more flames */
    .mega-flame-sprite {
      transform: scale(6);
    }

    .mega-flame-sprite .pixel-sprite {
      box-shadow:
        /* MEGA BAGUETTE - Evolved form with massive flame crown */

        /* Intense flame crown - towering inferno */
        8px 0px 0 #ffffff, 9px 0px 0 #fffbe8,
        7px 1px 0 #fffbe8, 8px 1px 0 #ffffff, 9px 1px 0 #fffbe8, 10px 1px 0 #ffe066,
        6px 2px 0 #ffe066, 7px 2px 0 #fffbe8, 8px 2px 0 #ffffff, 9px 2px 0 #fffbe8, 10px 2px 0 #ffe066, 11px 2px 0 #ffc233,
        5px 3px 0 #ffc233, 6px 3px 0 #ffe066, 7px 3px 0 #fffbe8, 8px 3px 0 #fffbe8, 9px 3px 0 #ffe066, 10px 3px 0 #ffc233, 11px 3px 0 #ff9500, 12px 3px 0 #ff7700,
        4px 4px 0 #ff9500, 5px 4px 0 #ffcc00, 6px 4px 0 #ffe066, 7px 4px 0 #fffbe8, 8px 4px 0 #ffe066, 9px 4px 0 #ffcc00, 10px 4px 0 #ff9500, 11px 4px 0 #ff6600, 12px 4px 0 #cc4400,
        4px 5px 0 #ff7700, 5px 5px 0 #ff9500, 6px 5px 0 #ffcc00, 7px 5px 0 #ffe066, 8px 5px 0 #ffcc00, 9px 5px 0 #ff9500, 10px 5px 0 #ff6600, 11px 5px 0 #cc4400, 12px 5px 0 #991100,
        5px 6px 0 #cc4400, 6px 6px 0 #ff6600, 7px 6px 0 #ff9500, 8px 6px 0 #ff9500, 9px 6px 0 #ff6600, 10px 6px 0 #cc4400, 11px 6px 0 #991100,
        6px 7px 0 #991100, 7px 7px 0 #cc4400, 8px 7px 0 #ff6600, 9px 7px 0 #cc4400, 10px 7px 0 #991100,

        /* Side flame wings */
        3px 4px 0 #fffbe8, 2px 5px 0 #ffe066, 3px 5px 0 #ffcc00, 3px 6px 0 #ff9500, 2px 6px 0 #ff6600, 2px 7px 0 #cc4400,
        14px 4px 0 #ffe066, 14px 5px 0 #ffc233, 13px 5px 0 #ff9500, 14px 6px 0 #ff6600, 13px 6px 0 #cc4400, 13px 7px 0 #991100,

        /* Larger baguette body */
        5px 8px 0 #fff4d6, 6px 8px 0 #fff4d6, 7px 8px 0 #ffe8b8, 8px 8px 0 #e8c097, 9px 8px 0 #d4a574, 10px 8px 0 #c99a65, 11px 8px 0 #b8894f,
        4px 9px 0 #fff4d6, 5px 9px 0 #ffe8b8, 6px 9px 0 #ffe8b8, 7px 9px 0 #e8c097, 8px 9px 0 #d4a574, 9px 9px 0 #c99a65, 10px 9px 0 #b8894f, 11px 9px 0 #a67c3d, 12px 9px 0 #8b5a2b,
        4px 10px 0 #ffe8b8, 5px 10px 0 #e8c097, 6px 10px 0 #e8c097, 7px 10px 0 #d4a574, 8px 10px 0 #c99a65, 9px 10px 0 #b8894f, 10px 10px 0 #a67c3d, 11px 10px 0 #8b5a2b, 12px 10px 0 #704214,
        4px 11px 0 #e8c097, 5px 11px 0 #d4a574, 6px 11px 0 #d4a574, 7px 11px 0 #c99a65, 8px 11px 0 #b8894f, 9px 11px 0 #a67c3d, 10px 11px 0 #8b5a2b, 11px 11px 0 #704214, 12px 11px 0 #5c3317,
        5px 12px 0 #c99a65, 6px 12px 0 #c99a65, 7px 12px 0 #b8894f, 8px 12px 0 #a67c3d, 9px 12px 0 #8b5a2b, 10px 12px 0 #704214, 11px 12px 0 #5c3317,
        6px 13px 0 #a67c3d, 7px 13px 0 #8b5a2b, 8px 13px 0 #704214, 9px 13px 0 #5c3317, 10px 13px 0 #4a2c0a,

        /* Determined eyes with fire reflection */
        5px 9px 0 #1a1a24, 6px 9px 0 #ff6600, 6px 10px 0 #1a1a24,
        10px 9px 0 #1a1a24, 11px 9px 0 #ff6600, 10px 10px 0 #1a1a24,

        /* Battle-ready blush */
        4px 10px 0 #ff8866, 12px 10px 0 #cc6644,

        /* Sturdy feet */
        5px 14px 0 #5c3317, 6px 14px 0 #704214, 7px 14px 0 #8b5a2b, 9px 14px 0 #5c3317, 10px 14px 0 #4a2c0a, 11px 14px 0 #3a1c00;
    }

    /* Evolution animations - dramatic Pokemon style */
    @keyframes evolve-pulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.15); filter: brightness(1.5); }
    }

    @keyframes evolve-glow {
      0% { filter: brightness(1) drop-shadow(0 0 0 #fff); }
      20% { filter: brightness(2) drop-shadow(0 0 30px #fff); }
      40% { filter: brightness(4) drop-shadow(0 0 60px #ffe066); }
      60% { filter: brightness(6) drop-shadow(0 0 80px #fff); }
      80% { filter: brightness(3) drop-shadow(0 0 40px #ff9500); }
      100% { filter: brightness(1.2) drop-shadow(0 0 10px #ff6600); }
    }

    @keyframes evolve-silhouette {
      0%, 100% { filter: brightness(1); }
      30%, 70% { filter: brightness(0) drop-shadow(0 0 50px #fff); }
    }

    @keyframes evolve-shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }

    .evolving {
      animation: evolve-pulse 0.4s ease-in-out infinite, evolve-shake 0.5s ease-in-out infinite;
    }

    .evolving-flash {
      animation: evolve-glow 2.5s ease-in-out forwards, evolve-silhouette 2.5s ease-in-out forwards;
    }

    /* Pokemon-style evolution - in place with particles */
    @keyframes evo-flash {
      0%, 100% { filter: brightness(1); }
      25%, 75% { filter: brightness(0) drop-shadow(0 0 20px #fff); }
      50% { filter: brightness(3) drop-shadow(0 0 40px #fff); }
    }

    .evo-flashing {
      animation: evo-flash 0.6s ease-in-out infinite;
    }

    /* Hide UI during evolution */
    .viewport.evolution-mode .stat-box,
    .viewport.evolution-mode .battle-panel,
    .viewport.evolution-mode .fight-panel,
    .viewport.evolution-mode .items-panel {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease-out;
    }

    /* Status effect indicators */
    .status-icon {
      display: inline-block;
      font-size: 8px;
      padding: 2px 4px;
      border-radius: 3px;
      margin-left: 6px;
      animation: status-pulse 1s ease-in-out infinite;
    }

    .status-icon.burn {
      background: linear-gradient(180deg, #ff6830 0%, #c83820 100%);
      color: #fff;
      box-shadow: 0 0 6px #ff4020;
    }

    .status-icon.poison {
      background: linear-gradient(180deg, #a040c0 0%, #702890 100%);
      color: #fff;
      box-shadow: 0 0 6px #a040c0;
    }

    @keyframes status-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Burn visual effect on creature */
    .creature.burning {
      animation: burn-flicker 0.3s ease-in-out infinite;
    }

    @keyframes burn-flicker {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3) sepia(0.3) saturate(1.5); }
    }

    /* Poison visual effect on creature */
    .creature.poisoned {
      animation: poison-pulse 0.8s ease-in-out infinite;
    }

    @keyframes poison-pulse {
      0%, 100% { filter: brightness(1) hue-rotate(0deg); }
      50% { filter: brightness(0.9) hue-rotate(60deg) saturate(1.3); }
    }

    /* Tornado particle around player sprite */
    .evo-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #fff 0%, #aaf 100%);
      border-radius: 50%;
      pointer-events: none;
      z-index: 30;
      box-shadow: 0 0 8px #fff;
    }

    @keyframes tornado-spin {
      0% { transform: rotate(0deg) translateX(60px) scale(1.2); opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { transform: rotate(540deg) translateX(5px) scale(0.3); opacity: 0; }
    }

    /* VOID SPECTER - Enemy sprite */
    .void-sprite {
      transform: scale(5);
    }

    .void-sprite .pixel-sprite {
      box-shadow:
        /* VOID SPECTER - Upper-left light, hue-shifted palette */
        /* Palette: Shadow #1a0533 (blue-violet) → Mid #7b2cbf (purple) → Highlight #e8c8ff (pink-lavender) */

        /* Hood peak - lit from upper-left */
        7px 3px 0 #e8c8ff, 8px 3px 0 #c77dff, 9px 3px 0 #9d4edd,
        6px 4px 0 #e8c8ff, 7px 4px 0 #c77dff, 8px 4px 0 #9d4edd, 9px 4px 0 #7b2cbf, 10px 4px 0 #5a189a,

        /* Cloak body - dramatic light falloff */
        5px 5px 0 #c77dff, 6px 5px 0 #9d4edd, 7px 5px 0 #7b2cbf, 8px 5px 0 #5a189a, 9px 5px 0 #3c096c, 10px 5px 0 #240046, 11px 5px 0 #1a0533,
        4px 6px 0 #e8c8ff, 5px 6px 0 #9d4edd, 6px 6px 0 #7b2cbf, 7px 6px 0 #5a189a, 8px 6px 0 #3c096c, 9px 6px 0 #240046, 10px 6px 0 #1a0533, 11px 6px 0 #0d0018, 12px 6px 0 #0d0018,
        4px 7px 0 #c77dff, 5px 7px 0 #9d4edd, 6px 7px 0 #7b2cbf, 7px 7px 0 #5a189a, 8px 7px 0 #3c096c, 9px 7px 0 #240046, 10px 7px 0 #1a0533, 11px 7px 0 #0d0018, 12px 7px 0 #0d0018,
        4px 8px 0 #9d4edd, 5px 8px 0 #7b2cbf, 6px 8px 0 #5a189a, 7px 8px 0 #3c096c, 8px 8px 0 #240046, 9px 8px 0 #1a0533, 10px 8px 0 #0d0018, 11px 8px 0 #0d0018, 12px 8px 0 #0d0018,
        5px 9px 0 #7b2cbf, 6px 9px 0 #5a189a, 7px 9px 0 #3c096c, 8px 9px 0 #240046, 9px 9px 0 #1a0533, 10px 9px 0 #0d0018, 11px 9px 0 #0d0018,
        5px 10px 0 #5a189a, 6px 10px 0 #3c096c, 7px 10px 0 #240046, 8px 10px 0 #1a0533, 9px 10px 0 #0d0018, 10px 10px 0 #0d0018,

        /* Wispy tail - fading into void */
        5px 11px 0 #3c096c, 6px 11px 0 #240046, 8px 11px 0 #1a0533, 10px 11px 0 #0d0018,
        4px 12px 0 #3c096c, 7px 12px 0 #1a0533, 9px 12px 0 #0d0018,
        5px 13px 0 #240046, 8px 13px 0 #0d0018,
        6px 14px 0 #1a0533,

        /* Glowing eyes - focal point with glow effect */
        5px 6px 0 #ffcccc, 6px 6px 0 #ff4444, 7px 6px 0 #ff0000, 8px 7px 0 #cc0000,
        5px 7px 0 #ffffff, 6px 7px 0 #ff6666,
        9px 6px 0 #ff4444, 10px 6px 0 #ff8888,
        9px 7px 0 #ff0000, 10px 7px 0 #ffffff;
    }

    /* SLIME - Second enemy sprite (green slime) */
    .slime-sprite {
      transform: scale(5);
    }

    .slime-sprite .pixel-sprite {
      box-shadow:
        /* SLIME - Upper-left light, hue-shifted palette */
        /* Palette: Shadow #1a6060 (teal) → Mid #4a9f4a (green) → Highlight #d4ff98 (yellow-green) */

        /* Top dome - brightest on upper-left */
        6px 5px 0 #e8ffb8, 7px 5px 0 #d4ff98, 8px 5px 0 #b8f878, 9px 5px 0 #8bd858,
        5px 6px 0 #e8ffb8, 6px 6px 0 #d4ff98, 7px 6px 0 #b8f878, 8px 6px 0 #8bd858, 9px 6px 0 #6bcf6b, 10px 6px 0 #4a9f4a, 11px 6px 0 #2a7f5a,

        /* Main body - gradient flows to bottom-right shadow */
        4px 7px 0 #d4ff98, 5px 7px 0 #b8f878, 6px 7px 0 #8bd858, 7px 7px 0 #6bcf6b, 8px 7px 0 #4a9f4a, 9px 7px 0 #3a8f5a, 10px 7px 0 #2a7f5a, 11px 7px 0 #1a6060, 12px 7px 0 #1a6060,
        4px 8px 0 #b8f878, 5px 8px 0 #8bd858, 6px 8px 0 #6bcf6b, 7px 8px 0 #4a9f4a, 8px 8px 0 #3a8f5a, 9px 8px 0 #2a7f5a, 10px 8px 0 #1a6060, 11px 8px 0 #156050, 12px 8px 0 #105040,
        4px 9px 0 #8bd858, 5px 9px 0 #6bcf6b, 6px 9px 0 #4a9f4a, 7px 9px 0 #3a8f5a, 8px 9px 0 #2a7f5a, 9px 9px 0 #1a6060, 10px 9px 0 #156050, 11px 9px 0 #105040, 12px 9px 0 #0a4030,
        5px 10px 0 #4a9f4a, 6px 10px 0 #3a8f5a, 7px 10px 0 #2a7f5a, 8px 10px 0 #1a6060, 9px 10px 0 #156050, 10px 10px 0 #105040, 11px 10px 0 #0a4030,

        /* Base spread - darkest teal at bottom */
        5px 11px 0 #2a7f5a, 6px 11px 0 #1a6060, 7px 11px 0 #156050, 8px 11px 0 #105040, 9px 11px 0 #0a4030, 10px 11px 0 #0a4030, 11px 11px 0 #053020,
        6px 12px 0 #156050, 7px 12px 0 #105040, 8px 12px 0 #0a4030, 9px 12px 0 #053020, 10px 12px 0 #053020,

        /* Eyes - large and focal, upper-left catchlight */
        5px 6px 0 #ffffff, 6px 6px 0 #ffffff, 6px 7px 0 #ffffff,
        5px 7px 0 #e8e8ff, 7px 7px 0 #1a1a24, 6px 8px 0 #1a1a24,
        9px 6px 0 #ffffff, 10px 6px 0 #f0f0ff,
        9px 7px 0 #e8e8ff, 10px 7px 0 #1a1a24, 9px 8px 0 #1a1a24,

        /* Specular highlight - crisp white on lit side */
        5px 5px 0 #ffffff, 6px 5px 0 #ffffff,

        /* Drip on shaded side only - follows gravity */
        12px 10px 0 #105040, 12px 11px 0 #0a4030, 12px 12px 0 #053020, 12px 13px 0 #053020;
    }

    /* INFERNO - Third enemy, fire demon */
    .inferno-sprite {
      transform: scale(5);
    }

    .inferno-sprite .pixel-sprite {
      box-shadow:
        /* INFERNO - Fierce fire demon, upper-left light */
        /* Palette: Shadow #660000 (dark red) → Mid #ff4400 (orange) → Highlight #ffff88 (yellow-white) */

        /* Flame head/horns */
        6px 2px 0 #ffff88, 10px 2px 0 #ffdd44,
        5px 3px 0 #ffff88, 6px 3px 0 #ffdd44, 10px 3px 0 #ffaa00, 11px 3px 0 #ff6600,
        5px 4px 0 #ffdd44, 6px 4px 0 #ffaa00, 10px 4px 0 #ff6600, 11px 4px 0 #cc3300,

        /* Head - demonic face */
        6px 5px 0 #ffff88, 7px 5px 0 #ffdd44, 8px 5px 0 #ffaa00, 9px 5px 0 #ff6600, 10px 5px 0 #cc3300,
        5px 6px 0 #ffff88, 6px 6px 0 #ffdd44, 7px 6px 0 #ffaa00, 8px 6px 0 #ff6600, 9px 6px 0 #ff4400, 10px 6px 0 #cc3300, 11px 6px 0 #990000,
        5px 7px 0 #ffdd44, 6px 7px 0 #ffaa00, 7px 7px 0 #ff6600, 8px 7px 0 #ff4400, 9px 7px 0 #cc3300, 10px 7px 0 #990000, 11px 7px 0 #660000,
        5px 8px 0 #ffaa00, 6px 8px 0 #ff6600, 7px 8px 0 #ff4400, 8px 8px 0 #cc3300, 9px 8px 0 #990000, 10px 8px 0 #660000, 11px 8px 0 #440000,

        /* Body - torso */
        6px 9px 0 #ff6600, 7px 9px 0 #ff4400, 8px 9px 0 #cc3300, 9px 9px 0 #990000, 10px 9px 0 #660000,
        6px 10px 0 #ff4400, 7px 10px 0 #cc3300, 8px 10px 0 #990000, 9px 10px 0 #660000, 10px 10px 0 #440000,
        7px 11px 0 #990000, 8px 11px 0 #660000, 9px 11px 0 #440000,

        /* Angry eyes - glowing white/yellow */
        6px 6px 0 #ffffff, 7px 6px 0 #ffff88,
        9px 6px 0 #ffffff, 10px 6px 0 #ffff88,
        6px 7px 0 #ffff00, 9px 7px 0 #ffff00,

        /* Mouth - jagged */
        7px 8px 0 #440000, 8px 8px 0 #ffff88, 9px 8px 0 #440000,

        /* Flame wisps around body */
        4px 5px 0 #ffff88, 3px 6px 0 #ffdd44, 4px 7px 0 #ffaa00, 3px 8px 0 #ff6600,
        12px 5px 0 #ffdd44, 13px 6px 0 #ffaa00, 12px 7px 0 #ff6600, 13px 8px 0 #cc3300,
        4px 9px 0 #ff4400, 12px 9px 0 #990000,

        /* Feet/base flames */
        6px 12px 0 #660000, 7px 12px 0 #440000, 9px 12px 0 #440000, 10px 12px 0 #330000,
        5px 13px 0 #ff6600, 6px 13px 0 #cc3300, 10px 13px 0 #660000, 11px 13px 0 #440000;
    }

    /* CRYSTOWL - Geometric ice owl */
    .crystowl-sprite {
      transform: scale(5);
      filter: drop-shadow(0 0 4px #88ddff) drop-shadow(0 0 8px #44aadd);
      animation: crystowl-hover 2s ease-in-out infinite, crystowl-shimmer 3s ease-in-out infinite;
    }

    @keyframes crystowl-hover {
      0%, 100% { transform: scale(5) translateY(0) rotate(-2deg); }
      50% { transform: scale(5) translateY(-6px) rotate(2deg); }
    }

    @keyframes crystowl-shimmer {
      0%, 100% { filter: drop-shadow(0 0 4px #88ddff) drop-shadow(0 0 8px #44aadd) brightness(1); }
      50% { filter: drop-shadow(0 0 8px #aaeeff) drop-shadow(0 0 16px #66ccff) brightness(1.2); }
    }

    .crystowl-sprite .pixel-sprite {
      box-shadow:
        /* CRYSTOWL - Ice crystal owl, upper-left lighting */
        /* Palette: Shadow #2266aa → Mid #44aadd → Highlight #eeffff */

        /* Ear tufts - ice crystal points */
        4px 1px 0 #eeffff, 5px 1px 0 #bbddff,
        12px 1px 0 #88ccff, 13px 1px 0 #44aadd,
        4px 2px 0 #bbddff, 5px 2px 0 #88ccff,
        12px 2px 0 #66bbee, 13px 2px 0 #2266aa,
        5px 3px 0 #88ccff,
        12px 3px 0 #44aadd,

        /* Head - geometric faceted */
        6px 3px 0 #eeffff, 7px 3px 0 #bbddff, 8px 3px 0 #bbddff, 9px 3px 0 #88ccff, 10px 3px 0 #66bbee, 11px 3px 0 #44aadd,
        5px 4px 0 #eeffff, 6px 4px 0 #bbddff, 7px 4px 0 #88ccff, 8px 4px 0 #88ccff, 9px 4px 0 #66bbee, 10px 4px 0 #44aadd, 11px 4px 0 #2266aa, 12px 4px 0 #2266aa,
        5px 5px 0 #bbddff, 6px 5px 0 #88ccff, 7px 5px 0 #66bbee, 8px 5px 0 #66bbee, 9px 5px 0 #44aadd, 10px 5px 0 #44aadd, 11px 5px 0 #2266aa, 12px 5px 0 #1a5588,

        /* Eyes - glowing cyan */
        6px 5px 0 #ffffff, 7px 5px 0 #aaffff,
        10px 5px 0 #88ffff, 11px 5px 0 #44dddd,
        6px 6px 0 #aaffff, 7px 6px 0 #00dddd,
        10px 6px 0 #00bbbb, 11px 6px 0 #008888,

        /* Beak - ice crystal */
        8px 6px 0 #eeffff, 9px 6px 0 #bbddff,
        8px 7px 0 #bbddff, 9px 7px 0 #88ccff,

        /* Lower face */
        5px 6px 0 #88ccff, 12px 6px 0 #2266aa,
        5px 7px 0 #66bbee, 6px 7px 0 #66bbee, 7px 7px 0 #44aadd, 10px 7px 0 #44aadd, 11px 7px 0 #2266aa, 12px 7px 0 #1a5588,

        /* Body - rounded with crystal facets */
        5px 8px 0 #eeffff, 6px 8px 0 #bbddff, 7px 8px 0 #88ccff, 8px 8px 0 #66bbee, 9px 8px 0 #66bbee, 10px 8px 0 #44aadd, 11px 8px 0 #2266aa, 12px 8px 0 #1a5588,
        4px 9px 0 #bbddff, 5px 9px 0 #88ccff, 6px 9px 0 #66bbee, 7px 9px 0 #44aadd, 8px 9px 0 #44aadd, 9px 9px 0 #2266aa, 10px 9px 0 #2266aa, 11px 9px 0 #1a5588, 12px 9px 0 #1a5588,
        4px 10px 0 #88ccff, 5px 10px 0 #66bbee, 6px 10px 0 #44aadd, 7px 10px 0 #2266aa, 8px 10px 0 #2266aa, 9px 10px 0 #1a5588, 10px 10px 0 #1a5588, 11px 10px 0 #104477,

        /* Wings - angular ice shards */
        2px 7px 0 #eeffff, 3px 7px 0 #bbddff,
        2px 8px 0 #bbddff, 3px 8px 0 #88ccff, 4px 8px 0 #66bbee,
        3px 9px 0 #66bbee,
        14px 7px 0 #66bbee, 15px 7px 0 #44aadd,
        13px 8px 0 #44aadd, 14px 8px 0 #2266aa, 15px 8px 0 #1a5588,
        13px 9px 0 #2266aa,

        /* Feet - small ice talons */
        6px 11px 0 #88ccff, 7px 11px 0 #66bbee, 9px 11px 0 #44aadd, 10px 11px 0 #2266aa,
        6px 12px 0 #44aadd, 10px 12px 0 #1a5588;
    }

    /* MOLDSPORE - Fuzzy mushroom creature */
    .moldspore-sprite {
      transform: scale(5);
      animation: moldspore-breathe 2.5s ease-in-out infinite, moldspore-toxic 4s ease-in-out infinite;
    }

    @keyframes moldspore-breathe {
      0%, 100% { transform: scale(5) scaleY(1); }
      50% { transform: scale(5) scaleY(1.05) scaleX(0.98); }
    }

    @keyframes moldspore-toxic {
      0%, 100% { filter: hue-rotate(0deg) brightness(1); }
      25% { filter: hue-rotate(10deg) brightness(1.1); }
      75% { filter: hue-rotate(-10deg) brightness(0.95); }
    }

    .moldspore-sprite .pixel-sprite {
      box-shadow:
        /* MOLDSPORE - Poison mushroom, upper-left lighting */
        /* Palette: Cap #8844aa → #aa66cc, Stem #55aa55 → #88cc88, Spots #ddaaff */

        /* Mushroom cap - bulbous top */
        6px 1px 0 #ddaaff, 7px 1px 0 #cc88ee, 8px 1px 0 #bb77dd, 9px 1px 0 #aa66cc, 10px 1px 0 #9955bb,
        5px 2px 0 #ddaaff, 6px 2px 0 #cc88ee, 7px 2px 0 #bb77dd, 8px 2px 0 #aa66cc, 9px 2px 0 #9955bb, 10px 2px 0 #8844aa, 11px 2px 0 #773399,
        4px 3px 0 #ddaaff, 5px 3px 0 #cc88ee, 6px 3px 0 #bb77dd, 7px 3px 0 #aa66cc, 8px 3px 0 #9955bb, 9px 3px 0 #8844aa, 10px 3px 0 #773399, 11px 3px 0 #662288, 12px 3px 0 #551177,
        4px 4px 0 #cc88ee, 5px 4px 0 #bb77dd, 6px 4px 0 #aa66cc, 7px 4px 0 #9955bb, 8px 4px 0 #8844aa, 9px 4px 0 #773399, 10px 4px 0 #662288, 11px 4px 0 #551177, 12px 4px 0 #440066,
        4px 5px 0 #bb77dd, 5px 5px 0 #aa66cc, 6px 5px 0 #9955bb, 7px 5px 0 #8844aa, 8px 5px 0 #773399, 9px 5px 0 #662288, 10px 5px 0 #551177, 11px 5px 0 #440066, 12px 5px 0 #330055,
        5px 6px 0 #9955bb, 6px 6px 0 #8844aa, 7px 6px 0 #773399, 8px 6px 0 #662288, 9px 6px 0 #551177, 10px 6px 0 #440066, 11px 6px 0 #330055,

        /* Cap spots - toxic highlights */
        6px 2px 0 #ffddff, 9px 3px 0 #eeccff,
        5px 4px 0 #ffddff, 10px 4px 0 #ddbbee,
        7px 5px 0 #eeccff,

        /* Eyes - beady and creepy */
        6px 5px 0 #ffff00, 7px 5px 0 #111100,
        9px 5px 0 #dddd00, 10px 5px 0 #111100,

        /* Stem - green fuzzy */
        6px 7px 0 #bbeeaa, 7px 7px 0 #99dd88, 8px 7px 0 #88cc77, 9px 7px 0 #77bb66, 10px 7px 0 #66aa55,
        6px 8px 0 #99dd88, 7px 8px 0 #88cc77, 8px 8px 0 #77bb66, 9px 8px 0 #66aa55, 10px 8px 0 #559944,
        6px 9px 0 #88cc77, 7px 9px 0 #77bb66, 8px 9px 0 #66aa55, 9px 9px 0 #559944, 10px 9px 0 #448833,
        7px 10px 0 #66aa55, 8px 10px 0 #559944, 9px 10px 0 #448833,

        /* Fuzzy spore particles floating */
        3px 3px 0 #ddaaff, 13px 2px 0 #cc88ee,
        2px 6px 0 #bb77dd, 14px 5px 0 #aa66cc,
        4px 8px 0 #99dd88, 12px 7px 0 #77bb66,
        3px 10px 0 #88cc77, 13px 9px 0 #66aa55;
    }

    /* TRAINER GHOST - Ghostly human trainer */
    .trainer-ghost-sprite {
      transform: scale(4);
      filter: drop-shadow(0 0 3px #9966ff) drop-shadow(0 0 6px #7744dd) drop-shadow(0 0 12px #5522bb);
      animation: ghost-float 2.5s ease-in-out infinite, ghost-flicker 4s ease-in-out infinite;
    }

    @keyframes ghost-float {
      0%, 100% { transform: scale(4) translateY(0); }
      50% { transform: scale(4) translateY(-5px); }
    }

    @keyframes ghost-flicker {
      0%, 100% { opacity: 0.95; }
      50% { opacity: 0.85; }
      52%, 54% { opacity: 0.6; }
    }

    .trainer-ghost-sprite .pixel-sprite {
      box-shadow:
        /* TRAINER GHOST - Detailed human trainer, spectral purple tones */
        /* Upper-left lighting, hue-shifted purples */

        /* Hair - flowing messy ghostly hair with highlights */
        5px 0px 0 #5a4a7a, 6px 0px 0 #6a5a8a, 7px 0px 0 #7a6a9a, 9px 0px 0 #6a5a8a, 11px 0px 0 #5a4a7a,
        4px 1px 0 #4a3a6a, 5px 1px 0 #7a6a9a, 6px 1px 0 #9a8aba, 7px 1px 0 #b8a8d8, 8px 1px 0 #9a8aba, 9px 1px 0 #8a7aaa, 10px 1px 0 #7a6a9a, 11px 1px 0 #5a4a7a, 12px 1px 0 #4a3a6a,
        4px 2px 0 #5a4a7a, 5px 2px 0 #8a7aaa, 6px 2px 0 #b8a8d8, 7px 2px 0 #c8b8e8, 8px 2px 0 #b8a8d8, 9px 2px 0 #9a8aba, 10px 2px 0 #8a7aaa, 11px 2px 0 #6a5a8a, 12px 2px 0 #4a3a6a,
        4px 3px 0 #6a5a8a, 5px 3px 0 #9a8aba, 6px 3px 0 #b8a8d8, 7px 3px 0 #b8a8d8, 8px 3px 0 #9a8aba, 9px 3px 0 #8a7aaa, 10px 3px 0 #7a6a9a, 11px 3px 0 #5a4a7a, 12px 3px 0 #3a2a5a,

        /* Forehead - pale ghostly with highlight */
        5px 4px 0 #8a7aaa, 6px 4px 0 #e8d8f8, 7px 4px 0 #f8e8ff, 8px 4px 0 #f8e8ff, 9px 4px 0 #e8d8f8, 10px 4px 0 #d8c8e8, 11px 4px 0 #7a6a9a,

        /* Eyes row - detailed with brows and catchlights */
        5px 5px 0 #c8b8d8, 6px 5px 0 #5a4a7a, 7px 5px 0 #e8d8f8, 8px 5px 0 #f8e8ff, 9px 5px 0 #e8d8f8, 10px 5px 0 #5a4a7a, 11px 5px 0 #b8a8c8,
        5px 6px 0 #d8c8e8, 6px 6px 0 #1a0a3a, 7px 6px 0 #e8d8f8, 8px 6px 0 #e8d8f8, 9px 6px 0 #e8d8f8, 10px 6px 0 #1a0a3a, 11px 6px 0 #c8b8d8,
        /* Eye glow */
        6px 6px 0 #cc66ff, 10px 6px 0 #aa44ff,
        6px 5px 0 #ffffff, 10px 5px 0 #ffaaff,

        /* Nose and cheeks */
        5px 7px 0 #d8c8e8, 6px 7px 0 #e8d8f8, 7px 7px 0 #f8e8ff, 8px 7px 0 #e8d8f8, 9px 7px 0 #e8d8f8, 10px 7px 0 #d8c8e8, 11px 7px 0 #c8b8d8,
        8px 7px 0 #d8c8e8,

        /* Mouth - confident smirk */
        5px 8px 0 #c8b8d8, 6px 8px 0 #d8c8e8, 7px 8px 0 #9a7aaa, 8px 8px 0 #7a5a8a, 9px 8px 0 #9a7aaa, 10px 8px 0 #c8b8d8, 11px 8px 0 #b8a8c8,

        /* Chin and jaw */
        6px 9px 0 #c8b8d8, 7px 9px 0 #d8c8e8, 8px 9px 0 #d8c8e8, 9px 9px 0 #c8b8d8, 10px 9px 0 #b8a8c8,

        /* Neck */
        7px 10px 0 #b8a8c8, 8px 10px 0 #c8b8d8, 9px 10px 0 #b8a8c8,

        /* High collar - detailed with folds */
        4px 11px 0 #2a1a4a, 5px 11px 0 #4a3a6a, 6px 11px 0 #5a4a7a, 7px 11px 0 #6a5a8a, 8px 11px 0 #6a5a8a, 9px 11px 0 #5a4a7a, 10px 11px 0 #4a3a6a, 11px 11px 0 #3a2a5a, 12px 11px 0 #2a1a4a,
        4px 12px 0 #3a2a5a, 5px 12px 0 #5a4a7a, 6px 12px 0 #6a5a8a, 7px 12px 0 #7a6a9a, 8px 12px 0 #7a6a9a, 9px 12px 0 #6a5a8a, 10px 12px 0 #5a4a7a, 11px 12px 0 #4a3a6a, 12px 12px 0 #2a1a4a,

        /* Coat body with lapels and shading */
        3px 13px 0 #1a0a3a, 4px 13px 0 #3a2a5a, 5px 13px 0 #5a4a7a, 6px 13px 0 #6a5a8a, 7px 13px 0 #7a6a9a, 8px 13px 0 #7a6a9a, 9px 13px 0 #6a5a8a, 10px 13px 0 #5a4a7a, 11px 13px 0 #4a3a6a, 12px 13px 0 #2a1a4a, 13px 13px 0 #1a0a3a,
        3px 14px 0 #2a1a4a, 4px 14px 0 #4a3a6a, 5px 14px 0 #6a5a8a, 6px 14px 0 #7a6a9a, 7px 14px 0 #8a7aaa, 8px 14px 0 #8a7aaa, 9px 14px 0 #7a6a9a, 10px 14px 0 #6a5a8a, 11px 14px 0 #4a3a6a, 12px 14px 0 #3a2a5a, 13px 14px 0 #1a0a3a,
        3px 15px 0 #2a1a4a, 4px 15px 0 #4a3a6a, 5px 15px 0 #6a5a8a, 6px 15px 0 #7a6a9a, 7px 15px 0 #7a6a9a, 8px 15px 0 #7a6a9a, 9px 15px 0 #6a5a8a, 10px 15px 0 #5a4a7a, 11px 15px 0 #4a3a6a, 12px 15px 0 #2a1a4a, 13px 15px 0 #1a0a3a,
        3px 16px 0 #1a0a3a, 4px 16px 0 #3a2a5a, 5px 16px 0 #5a4a7a, 6px 16px 0 #6a5a8a, 7px 16px 0 #6a5a8a, 8px 16px 0 #6a5a8a, 9px 16px 0 #5a4a7a, 10px 16px 0 #4a3a6a, 11px 16px 0 #3a2a5a, 12px 16px 0 #1a0a3a, 13px 16px 0 #0a0020,

        /* Glowing coat buttons */
        8px 13px 0 #bb88ff, 8px 14px 0 #aa66ff, 8px 15px 0 #9955ee,

        /* Arms/sleeves */
        2px 14px 0 #c8b8d8, 2px 15px 0 #d8c8e8, 3px 15px 0 #c8b8d8,
        14px 14px 0 #b8a8c8, 14px 15px 0 #c8b8d8,

        /* Hands - ghostly pale */
        2px 16px 0 #e8d8f8, 2px 17px 0 #d8c8e8,
        14px 16px 0 #d8c8e8, 14px 17px 0 #c8b8d8,

        /* Coat tails / lower body fading */
        4px 17px 0 #2a1a4a, 5px 17px 0 #3a2a5a, 6px 17px 0 #4a3a6a, 7px 17px 0 #4a3a6a, 9px 17px 0 #4a3a6a, 10px 17px 0 #3a2a5a, 11px 17px 0 #2a1a4a, 12px 17px 0 #1a0a3a,
        5px 18px 0 #2a1a4a, 6px 18px 0 #3a2a5a, 7px 18px 0 #3a2a5a, 9px 18px 0 #3a2a5a, 10px 18px 0 #2a1a4a, 11px 18px 0 #1a0a3a,
        5px 19px 0 #1a0a3a, 6px 19px 0 #2a1a4a, 10px 19px 0 #1a0a3a, 11px 19px 0 #0a0020,

        /* Ghostly wisps dissolving */
        4px 20px 0 #1a0a3a, 6px 20px 0 #1a0a3a, 8px 20px 0 #2a1a4a, 10px 20px 0 #1a0a3a, 12px 20px 0 #0a0020,
        5px 21px 0 #0a0020, 7px 21px 0 #1a0a3a, 9px 21px 0 #0a0020, 11px 21px 0 #0a0020,
        6px 22px 0 #0a0020, 8px 22px 0 #0a0020, 10px 22px 0 #0a0020;
    }

    /* Trainer appear overlay */
    .trainer-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 32%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 55;
    }

    .trainer-sprite-container {
      position: absolute;
      top: 22%;
      right: 18%;
      transform: translateX(50%);
    }

    /* Ending screen */
    .ending-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, #98d8a0 0%, #68a870 100%);
      z-index: 60;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: fade-in 1s ease-out;
    }

    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .ending-logo {
      font-family: 'Press Start 2P', cursive;
      font-size: 28px;
      color: #2a4a2a;
      text-shadow: 2px 2px 0 #1a3a1a, -1px -1px 0 #4a6a4a;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .ending-logo-sub {
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      color: #c8483c;
      letter-spacing: 4px;
      margin-bottom: 40px;
    }

    .ending-sprite {
      margin-bottom: 30px;
    }

    .ending-text {
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      color: #2a4a2a;
      margin-bottom: 20px;
      text-align: center;
      line-height: 1.8;
    }

    .ending-links {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .ending-links a {
      font-family: 'Press Start 2P', cursive;
      font-size: 9px;
      color: #1a3a1a;
      text-decoration: none;
    }

    .ending-links a:hover {
      color: #c8483c;
    }

    .play-again-btn {
      margin-top: 20px;
      padding: 12px 24px;
      background: linear-gradient(180deg, #f8f0d8 0%, #e8e0c8 100%);
      border: 3px solid #484038;
      border-radius: 8px;
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      color: #303030;
      cursor: pointer;
      transition: all 0.15s;
    }

    .play-again-btn:hover {
      background: linear-gradient(180deg, #fff8e8 0%, #f8f0d8 100%);
      transform: scale(1.05);
    }

    .play-again-btn:active {
      transform: scale(0.98);
    }

    /* EXP bar */
    .exp-bar-container {
      position: absolute;
      bottom: 34%;
      right: 2%;
      width: 44%;
      z-index: 21;
    }

    .exp-bar-bg {
      height: 6px;
      background: #484038;
      border-radius: 3px;
      overflow: hidden;
    }

    .exp-bar-inner {
      height: 100%;
      background: linear-gradient(180deg, #58c8f8 0%, #2090c8 100%);
      width: 0%;
      transition: width 1s ease-out;
    }

    /* Faint animation */
    @keyframes faintDrop {
      0% { transform: translateY(0) scaleX(-1); opacity: 1; }
      100% { transform: translateY(60px) scaleX(-1); opacity: 0; }
    }

    .creature-enemy.fainting {
      animation: faintDrop 0.8s ease-in forwards !important;
    }

    /* Appear animation */
    @keyframes appearPop {
      0% { transform: scale(0) scaleX(-1); opacity: 0; }
      50% { transform: scale(1.2) scaleX(-1); }
      100% { transform: scale(1) scaleX(-1); opacity: 1; }
    }

    .creature-enemy.appearing {
      animation: appearPop 0.5s ease-out forwards !important;
    }

    /* Creature animations */
    @keyframes creatureBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @keyframes enemyFloat {
      0%, 100% { transform: translateY(0) scaleX(-1); }
      50% { transform: translateY(-8px) scaleX(-1); }
    }

    .creature-player { animation: creatureBounce 1s ease-in-out infinite; }
    .creature-enemy { animation: enemyFloat 1.5s ease-in-out infinite; }

    /* Attack flash */
    @keyframes hitFlash {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(3) saturate(0); }
    }

    .creature.hit {
      animation: hitFlash 0.1s ease-in-out 4 !important;
    }

    /* Bottom battle panel - FireRed style */
    .battle-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: flex;
      z-index: 30;
    }

    .message-box {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 12px 14px;
      display: flex;
      align-items: flex-start;
    }

    .message-text {
      font-size: 15px;
      color: #303030;
      line-height: 1.6;
    }

    /* Pokemon-style announcement textbox */
    .announce-box {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 12px 12px 0 0;
      padding: 16px 20px;
      z-index: 60;
      min-height: 70px;
      display: none;
    }

    .announce-box.visible {
      display: block;
    }

    .announce-text {
      font-size: 18px;
      color: #303030;
      line-height: 1.5;
      font-family: 'Pokemon GB', monospace;
    }

    .announce-box::after {
      content: '▼';
      position: absolute;
      bottom: 8px;
      right: 12px;
      font-size: 12px;
      color: #484038;
      animation: bounce-arrow 0.6s ease-in-out infinite;
    }

    @keyframes bounce-arrow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(3px); }
    }

    .action-box {
      width: 46%;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 8px 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      align-items: center;
    }

    .action-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 13px;
      padding: 10px 4px 10px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      white-space: nowrap;
    }

    .action-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 10px;
      transition: opacity 0.1s;
    }

    .action-btn:hover::before,
    .action-btn:active::before,
    .action-btn.selected::before { opacity: 1; }

    .action-btn.selected {
      background: rgba(0,0,0,0.05);
    }

    /* Fight panel - FireRed style */
    .fight-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: none;
      z-index: 31;
    }

    .fight-panel.active { display: flex; }

    .moves-box {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      padding: 8px;
      align-items: center;
    }

    .move-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      padding: 8px 4px 8px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      white-space: nowrap;
    }

    .move-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 9px;
      transition: opacity 0.1s;
    }

    .move-btn:hover::before,
    .move-btn:active::before,
    .move-btn.selected::before { opacity: 1; }

    .move-btn.selected {
      background: rgba(0,0,0,0.05);
    }

    .move-info {
      width: 32%;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 12px;
      font-size: 12px;
      color: #303030;
      line-height: 1.8;
    }

    /* Items panel - FireRed style */
    .items-panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 32%;
      background: #78c850;
      border-top: 4px solid #484038;
      display: none;
      z-index: 31;
    }

    .items-panel.active { display: flex; }

    .items-list {
      flex: 1;
      background: #f8f8f8;
      border: 4px solid #484038;
      border-radius: 10px;
      margin: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .item-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 12px;
      padding: 10px 4px 10px 22px;
      background: transparent;
      border: none;
      color: #303030;
      cursor: pointer;
      text-align: left;
      position: relative;
      display: flex;
      justify-content: space-between;
    }

    .item-btn::before {
      content: '▶';
      position: absolute;
      left: 4px;
      opacity: 0;
      font-size: 9px;
      transition: opacity 0.1s;
    }

    .item-btn:hover::before,
    .item-btn:active::before,
    .item-btn.selected::before { opacity: 1; }

    .item-btn.selected {
      background: rgba(0,0,0,0.05);
    }

    .item-count { color: #606060; }

    /* PARTICLE SYSTEMS */
    .particle {
      position: absolute;
      pointer-events: none;
      z-index: 45;
    }

    /* Fire particles - teardrop wisps */
    .fire-particle {
      width: 8px;
      height: 12px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 40%, #ff6b35 80%, transparent 100%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      animation: fireWisp 0.6s ease-out forwards;
    }

    @keyframes fireWisp {
      0% { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: scale(0.2) translateY(-35px) rotate(var(--rot, 30deg)); }
    }

    /* Ember particles - sparks that scatter */
    .ember-particle {
      width: 4px;
      height: 8px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 50%, #ff6b35 100%);
      border-radius: 50% 50% 20% 20%;
      box-shadow: 0 0 6px #ff6b35, 0 0 12px #ffd23f;
      animation: emberSpark 0.5s ease-out forwards;
    }

    @keyframes emberSpark {
      0% { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); }
      50% { opacity: 1; }
      100% { opacity: 0; transform: scale(0.3) translateY(-25px) translateX(var(--dx)) rotate(180deg); }
    }

    /* Flamethrower stream particles */
    .flame-stream-particle {
      width: 16px;
      height: 10px;
      background: linear-gradient(90deg, #cc3300 0%, #ff6b35 30%, #ffd23f 60%, #fff 100%);
      border-radius: 30% 70% 70% 30% / 50%;
      box-shadow: 0 0 15px #ff6b35, 0 0 30px #f7931e;
      animation: flameStreamParticle 0.4s ease-out forwards;
    }

    @keyframes flameStreamParticle {
      0% { opacity: 1; transform: scale(1.2) scaleX(1.5); }
      100% { opacity: 0; transform: scale(0.3) scaleX(0.5) translateY(-10px); }
    }

    /* Shadow Ball */
    .shadow-particle {
      width: 12px;
      height: 12px;
      background: radial-gradient(circle, #e0aaff 0%, #9d4edd 40%, #7b2cbf 70%, #3c096c 100%);
      border-radius: 50%;
      box-shadow: 0 0 10px #9d4edd, 0 0 20px #7b2cbf;
      animation: shadowPulse 0.5s ease-out forwards;
    }

    @keyframes shadowPulse {
      0% { opacity: 1; transform: scale(1); filter: brightness(1); }
      50% { filter: brightness(1.5); }
      100% { opacity: 0; transform: scale(0.2); }
    }

    /* Crunch - dark bite impact */
    .crunch-particle {
      width: 14px;
      height: 14px;
      background: linear-gradient(135deg, #2a1a0a 0%, #4a3020 50%, #1a0a00 100%);
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      box-shadow: 0 0 8px #4a3020, 0 0 15px #2a1a0a;
      animation: crunchBite 0.4s ease-out forwards;
    }

    @keyframes crunchBite {
      0% { opacity: 1; transform: scale(1.5) rotate(0deg); }
      30% { transform: scale(2) rotate(45deg); }
      100% { opacity: 0; transform: scale(0.3) rotate(90deg) translateY(-15px); }
    }

    /* Fire Blast - explosive star bursts */
    .blast-particle {
      width: 28px;
      height: 28px;
      background: radial-gradient(circle, #fff 0%, #ffd23f 25%, #ff6b35 50%, #cc3300 75%, #660000 100%);
      clip-path: polygon(50% 0%, 65% 35%, 100% 50%, 65% 65%, 50% 100%, 35% 65%, 0% 50%, 35% 35%);
      box-shadow: 0 0 30px #ff6b35, 0 0 60px #f7931e;
      animation: blastExplode 0.7s ease-out forwards;
    }

    @keyframes blastExplode {
      0% { opacity: 1; transform: scale(0.3) rotate(0deg); }
      30% { transform: scale(2.5) rotate(45deg); }
      100% { opacity: 0; transform: scale(0.5) rotate(90deg); }
    }

    /* Void attack */
    .void-particle {
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #c77dff 0%, #7b2cbf 60%, #240046 100%);
      border-radius: 50%;
      box-shadow: 0 0 8px #9d4edd;
      animation: voidWisp 0.5s ease-out forwards;
    }

    @keyframes voidWisp {
      0% { opacity: 1; transform: scale(1) rotate(0deg); }
      100% { opacity: 0; transform: scale(0.3) rotate(180deg) translateY(20px); }
    }

    /* Ice shard particles - CRYSTOWL */
    .ice-particle {
      width: 6px;
      height: 14px;
      background: linear-gradient(180deg, #ffffff 0%, #aaeeff 30%, #44aadd 70%, #2266aa 100%);
      clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
      box-shadow: 0 0 8px #88ddff, 0 0 16px #44aadd;
      animation: iceShard 0.6s ease-out forwards;
    }

    @keyframes iceShard {
      0% { opacity: 1; transform: scale(1) rotate(0deg) translateY(0); }
      50% { opacity: 1; transform: scale(1.3) rotate(180deg) translateY(-15px); }
      100% { opacity: 0; transform: scale(0.5) rotate(360deg) translateY(-30px); }
    }

    /* Spore particles - MOLDSPORE */
    .spore-particle {
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #ddaaff 0%, #aa66cc 50%, #773399 100%);
      border-radius: 50%;
      box-shadow: 0 0 6px #bb77dd, 0 0 12px #8844aa;
      animation: sporeDrift 1s ease-out forwards;
    }

    @keyframes sporeDrift {
      0% { opacity: 0.8; transform: scale(0.5) translateY(0) translateX(0); }
      30% { opacity: 1; transform: scale(1.2) translateY(-10px) translateX(var(--dx, 5px)); }
      100% { opacity: 0; transform: scale(0.3) translateY(-40px) translateX(calc(var(--dx, 5px) * 2)); }
    }

    /* Ice attack shader - screen freeze effect */
    .viewport.ice-attack {
      animation: iceShader 0.4s ease-out;
    }

    @keyframes iceShader {
      0% { filter: brightness(1) saturate(1) hue-rotate(0deg); }
      30% { filter: brightness(1.4) saturate(0.5) hue-rotate(-30deg); }
      60% { filter: brightness(1.2) saturate(0.8) hue-rotate(-15deg) contrast(1.1); }
      100% { filter: brightness(1) saturate(1) hue-rotate(0deg); }
    }

    .viewport.ice-attack::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, transparent 30%, rgba(136, 221, 255, 0.3) 100%);
      animation: iceFrost 0.4s ease-out;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes iceFrost {
      0% { opacity: 0; }
      40% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Toxic spore shader - poison cloud effect */
    .viewport.toxic-attack {
      animation: toxicShader 0.5s ease-out;
    }

    @keyframes toxicShader {
      0% { filter: brightness(1) saturate(1) hue-rotate(0deg); }
      25% { filter: brightness(0.9) saturate(1.3) hue-rotate(60deg); }
      50% { filter: brightness(0.85) saturate(1.5) hue-rotate(90deg) blur(1px); }
      100% { filter: brightness(1) saturate(1) hue-rotate(0deg) blur(0px); }
    }

    .viewport.toxic-attack::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(170, 102, 204, 0.4) 0%, rgba(119, 51, 153, 0.2) 50%, transparent 70%);
      animation: toxicCloud 0.5s ease-out;
      pointer-events: none;
      z-index: 100;
    }

    @keyframes toxicCloud {
      0% { opacity: 0; transform: scale(0.5); }
      40% { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0; transform: scale(1.5); }
    }

    /* Heal particles */
    .heal-particle {
      width: 8px;
      height: 8px;
      background: #58f858;
      border-radius: 50%;
      box-shadow: 0 0 10px #58f858, 0 0 20px #20b820;
      animation: healSparkle 0.8s ease-out forwards;
    }

    @keyframes healSparkle {
      0% { opacity: 0; transform: scale(0) translateY(20px); }
      30% { opacity: 1; transform: scale(1.5) translateY(10px); }
      100% { opacity: 0; transform: scale(0.5) translateY(-30px); }
    }

    /* Super heal */
    .super-heal-particle {
      width: 10px;
      height: 10px;
      background: linear-gradient(135deg, #ffd23f 0%, #f7931e 100%);
      border-radius: 2px;
      transform: rotate(45deg);
      box-shadow: 0 0 12px #ffd23f, 0 0 24px #f7931e;
      animation: superHealSparkle 1s ease-out forwards;
    }

    @keyframes superHealSparkle {
      0% { opacity: 0; transform: rotate(0deg) scale(0) translateY(30px); }
      40% { opacity: 1; transform: rotate(180deg) scale(1.2) translateY(0); }
      100% { opacity: 0; transform: rotate(360deg) scale(0) translateY(-40px); }
    }

    /* Max heal */
    .max-heal-particle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: maxHealBurst 1.2s ease-out forwards;
    }

    @keyframes maxHealBurst {
      0% { opacity: 0; transform: scale(0); }
      30% { opacity: 1; transform: scale(2); }
      100% { opacity: 0; transform: scale(0.5) translateY(-50px); }
    }

    /* Antidote particles - purple/blue cleansing */
    .antidote-particle {
      width: 8px;
      height: 8px;
      background: linear-gradient(135deg, #e0aaff 0%, #9d4edd 100%);
      border-radius: 50%;
      box-shadow: 0 0 10px #c77dff, 0 0 20px #9d4edd;
      animation: antidoteRise 0.9s ease-out forwards;
    }

    @keyframes antidoteRise {
      0% { opacity: 0; transform: scale(0) translateY(20px); }
      30% { opacity: 1; transform: scale(1.2) translateY(0); }
      100% { opacity: 0; transform: scale(0.5) translateY(-40px); }
    }

    /* Burn cure particles - cool blue soothing */
    .burn-cure-particle {
      width: 9px;
      height: 9px;
      background: linear-gradient(135deg, #88ddff 0%, #44aadd 100%);
      border-radius: 50%;
      box-shadow: 0 0 10px #88ddff, 0 0 20px #44aadd;
      animation: burnCureCool 0.9s ease-out forwards;
    }

    @keyframes burnCureCool {
      0% { opacity: 0; transform: scale(0) translateY(20px); }
      30% { opacity: 1; transform: scale(1.3) translateY(0); }
      100% { opacity: 0; transform: scale(0.4) translateY(-35px); }
    }

    /* Attack projectiles */
    .projectile {
      position: absolute;
      border-radius: 50%;
      z-index: 35;
      pointer-events: none;
    }

    /* EMBER - flickering teardrop flame */
    .projectile.ember {
      width: 14px;
      height: 20px;
      background: linear-gradient(180deg, #fff8e0 0%, #ffd23f 30%, #ff6b35 70%, #cc3300 100%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow: 0 0 14px #ff6b35, 0 0 28px #f7931e;
      animation: emberFlicker 0.1s ease-in-out infinite;
    }

    @keyframes emberFlicker {
      0%, 100% { transform: scaleX(1) scaleY(1); }
      50% { transform: scaleX(0.85) scaleY(1.1); }
    }

    /* FLAMETHROWER - elongated fire stream */
    .projectile.flamethrower {
      width: 35px;
      height: 18px;
      background: linear-gradient(90deg, #cc3300 0%, #ff6b35 20%, #ffd23f 50%, #fff 80%, #ffd23f 100%);
      border-radius: 20% 80% 80% 20% / 50% 50% 50% 50%;
      box-shadow: 0 0 20px #ff6b35, 0 0 40px #f7931e, 0 -5px 30px #ffd23f;
      animation: flameStream 0.08s ease-in-out infinite;
    }

    @keyframes flameStream {
      0%, 100% { transform: scaleX(1) skewX(0deg); }
      25% { transform: scaleX(1.1) skewX(-3deg); }
      75% { transform: scaleX(0.95) skewX(3deg); }
    }

    /* SHADOW BALL - swirling dark energy */
    .projectile.shadow-ball {
      width: 24px;
      height: 24px;
      background: radial-gradient(circle at 30% 30%, #e0aaff 0%, #9d4edd 25%, #7b2cbf 50%, #3c096c 80%, #240046 100%);
      border-radius: 50%;
      box-shadow: 0 0 18px #9d4edd, 0 0 36px #7b2cbf, inset 0 0 10px #240046;
      animation: shadowSwirl 0.2s linear infinite;
    }

    @keyframes shadowSwirl {
      0% { transform: rotate(0deg); background-position: 0% 0%; }
      100% { transform: rotate(360deg); }
    }

    /* FIRE BLAST - explosive star shape */
    .projectile.fire-blast {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #fff 0%, #ffd23f 15%, #ff6b35 35%, #cc3300 60%, #660000 100%);
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      box-shadow: 0 0 40px #ff6b35, 0 0 80px #f7931e, 0 0 120px #cc3300;
      animation: fireBlastPulse 0.1s ease-in-out infinite;
    }

    @keyframes fireBlastPulse {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.15) rotate(18deg); }
    }

    .projectile.void {
      width: 18px;
      height: 18px;
      background: radial-gradient(circle, #c77dff 0%, #9d4edd 40%, #7b2cbf 70%, #240046 100%);
      box-shadow: 0 0 14px #9d4edd, 0 0 28px #7b2cbf;
    }

    .projectile.sludge {
      width: 20px;
      height: 18px;
      background: radial-gradient(ellipse, #98e898 0%, #6bcf6b 30%, #4a9f4a 60%, #2a6f2a 100%);
      box-shadow: 0 0 16px #6bcf6b, 0 0 32px #4a9f4a;
      border-radius: 60% 40% 50% 50%;
      animation: sludgeWobble 0.3s ease-in-out infinite;
    }

    @keyframes sludgeWobble {
      0%, 100% { transform: scaleX(1) scaleY(1); }
      50% { transform: scaleX(1.1) scaleY(0.9); }
    }

    /* Sludge particles */
    .sludge-particle {
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #98e898 0%, #4a9f4a 70%, #2a6f2a 100%);
      border-radius: 60% 40% 70% 30%;
      box-shadow: 0 0 10px #6bcf6b;
      animation: sludgeDrip 0.6s ease-out forwards;
    }

    @keyframes sludgeDrip {
      0% { opacity: 1; transform: scale(1) translateY(0); }
      100% { opacity: 0; transform: scale(0.5) translateY(25px); }
    }

    /* Ice projectile */
    .projectile.ice {
      width: 18px;
      height: 18px;
      background: radial-gradient(circle, #ffffff 0%, #88ddff 30%, #44aadd 60%, #2288bb 100%);
      box-shadow: 0 0 16px #88ddff, 0 0 32px #44aadd, inset 0 0 8px rgba(255,255,255,0.8);
      border-radius: 50%;
      animation: iceSpin 0.2s linear infinite;
    }

    @keyframes iceSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* Ice particles */
    .ice-particle {
      width: 8px;
      height: 12px;
      background: linear-gradient(135deg, #ffffff 0%, #88ddff 50%, #44aadd 100%);
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      box-shadow: 0 0 8px #88ddff;
      animation: iceFall 0.5s ease-out forwards;
    }

    @keyframes iceFall {
      0% { opacity: 1; transform: scale(1) rotate(0deg) translateY(0); }
      100% { opacity: 0; transform: scale(0.3) rotate(180deg) translateY(30px); }
    }

    /* Spore projectile */
    .projectile.spore {
      width: 22px;
      height: 22px;
      background: radial-gradient(circle, #dda0dd 0%, #9370db 30%, #6b4e8b 60%, #4a2c5a 100%);
      box-shadow: 0 0 16px #9370db, 0 0 32px #6b4e8b;
      border-radius: 50%;
      animation: sporePulse 0.3s ease-in-out infinite;
    }

    @keyframes sporePulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.15); filter: brightness(1.3); }
    }

    /* Spore particles */
    .spore-particle {
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, #dda0dd 0%, #9370db 70%);
      border-radius: 50%;
      box-shadow: 0 0 6px #9370db;
      animation: sporeFloat 0.8s ease-out forwards;
    }

    @keyframes sporeFloat {
      0% { opacity: 1; transform: scale(1) translateY(0) translateX(0); }
      100% { opacity: 0; transform: scale(0.5) translateY(-20px) translateX(var(--spore-drift, 10px)); }
    }

    /* Screen splat overlay */
    .screen-splat {
      position: absolute;
      pointer-events: none;
      z-index: 48;
      opacity: 0;
    }

    .screen-splat.active {
      animation: splatFade 2s ease-out forwards;
    }

    @keyframes splatFade {
      0% { opacity: 0.9; }
      70% { opacity: 0.7; }
      100% { opacity: 0; }
    }

    .splat-blob {
      position: absolute;
      background: radial-gradient(ellipse, #6bcf6b 0%, #4a9f4a 50%, #2a6f2a 80%, transparent 100%);
      border-radius: 50% 40% 60% 50%;
      box-shadow: inset 0 -5px 15px rgba(0,0,0,0.3), 0 0 20px #6bcf6b;
    }

    .splat-drip {
      position: absolute;
      background: linear-gradient(180deg, #4a9f4a 0%, #2a6f2a 100%);
      border-radius: 50% 50% 40% 40%;
      animation: dripDown 2s ease-in forwards;
    }

    @keyframes dripDown {
      0% { transform: translateY(0) scaleY(1); }
      100% { transform: translateY(40px) scaleY(1.5); }
    }

    /* Damage number - BIGGER */
    .damage-num {
      position: absolute;
      font-family: 'Press Start 2P', cursive;
      font-size: 18px;
      color: #fff;
      text-shadow: 3px 3px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
      z-index: 40;
      animation: damageFloat 1s ease-out forwards;
      pointer-events: none;
    }

    .damage-num.crit {
      font-size: 24px;
      color: #ff6b35;
    }

    .damage-num.heal {
      color: #58f858;
    }

    @keyframes damageFloat {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      20% { transform: translateY(-10px) scale(1.3); }
      100% { opacity: 0; transform: translateY(-40px) scale(1); }
    }

    /* Impact flash overlay */
    .impact-flash {
      position: absolute;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 49;
    }

    .impact-flash.active {
      animation: impactFlash 0.15s ease-out;
    }

    @keyframes impactFlash {
      0% { opacity: 0.7; }
      100% { opacity: 0; }
    }

    /* Bottom rim - control area */
    .bottom-rim {
      height: 120px;
      margin-top: 0.8rem;
      position: relative;
      background: linear-gradient(180deg, rgba(0,0,0,0.05) 0%, transparent 30%);
      border-radius: 0 0 40px 40px;
    }

    .gameboy-shell.dmg-mode .bottom-rim {
      height: 130px;
      border-radius: 0 0 16px 16px;
    }

    /* D-Pad */
    .dpad {
      position: absolute;
      top: 15px;
      left: 20px;
      width: 50px;
      height: 50px;
    }

    .dpad-horizontal, .dpad-vertical {
      position: absolute;
      background: linear-gradient(180deg, #3a3a4a 0%, #2a2a3a 50%, #1a1a2a 100%);
      border-radius: 3px;
      box-shadow:
        inset 0 1px 1px rgba(255,255,255,0.1),
        0 2px 4px rgba(0,0,0,0.4);
    }

    .dpad-horizontal {
      width: 50px;
      height: 16px;
      top: 17px;
      left: 0;
    }

    .dpad-vertical {
      width: 16px;
      height: 50px;
      top: 0;
      left: 17px;
    }

    .dpad-center {
      position: absolute;
      width: 12px;
      height: 12px;
      background: radial-gradient(circle, #4a4a5a 0%, #2a2a3a 100%);
      border-radius: 50%;
      top: 19px;
      left: 19px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
    }

    /* DMG D-Pad - darker black */
    .gameboy-shell.dmg-mode .dpad-horizontal,
    .gameboy-shell.dmg-mode .dpad-vertical {
      background: linear-gradient(180deg, #2a2a28 0%, #1a1a18 50%, #0a0a08 100%);
    }

    .gameboy-shell.dmg-mode .dpad-center {
      background: radial-gradient(circle, #3a3a38 0%, #1a1a18 100%);
    }

    /* D-pad clickable areas */
    .dpad-up, .dpad-down, .dpad-left, .dpad-right {
      position: absolute;
      cursor: pointer;
      z-index: 5;
    }

    .dpad-up { top: 0; left: 14px; width: 22px; height: 20px; }
    .dpad-down { bottom: 0; left: 14px; width: 22px; height: 20px; }
    .dpad-left { left: 0; top: 14px; width: 20px; height: 22px; }
    .dpad-right { right: 0; top: 14px; width: 20px; height: 22px; }

    .dpad-up:active ~ .dpad-vertical,
    .dpad-down:active ~ .dpad-vertical {
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
    }

    .dpad-left:active ~ .dpad-horizontal,
    .dpad-right:active ~ .dpad-horizontal {
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
    }

    /* A/B Buttons */
    .ab-buttons {
      position: absolute;
      top: 18px;
      right: 18px;
      transform: rotate(-25deg);
      display: flex;
      gap: 10px;
    }

    .btn-a, .btn-b {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      box-shadow:
        inset 0 2px 3px rgba(255,255,255,0.3),
        inset 0 -2px 3px rgba(0,0,0,0.3),
        0 3px 6px rgba(0,0,0,0.4);
      position: relative;
    }

    .btn-a {
      background: linear-gradient(180deg, #9060b0 0%, #7040a0 50%, #503080 100%);
    }

    .btn-b {
      background: linear-gradient(180deg, #9060b0 0%, #7040a0 50%, #503080 100%);
    }

    .btn-label {
      position: absolute;
      bottom: -14px;
      left: 50%;
      transform: translateX(-50%) rotate(25deg);
      font-size: 6px;
      color: rgba(255,255,255,0.5);
    }

    /* DMG A/B - maroon/dark red */
    .gameboy-shell.dmg-mode .btn-a,
    .gameboy-shell.dmg-mode .btn-b {
      background: linear-gradient(180deg, #a04858 0%, #803040 50%, #602030 100%);
    }

    .gameboy-shell.dmg-mode .btn-label {
      color: rgba(60,60,56,0.7);
    }

    .btn-a:active, .btn-b:active {
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.5),
        0 1px 2px rgba(0,0,0,0.3);
      transform: translateY(1px);
    }

    .btn-a, .btn-b {
      cursor: pointer;
      transition: transform 0.05s, box-shadow 0.05s;
    }

    /* START/SELECT */
    .start-select {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
    }

    .btn-start, .btn-select {
      width: 32px;
      height: 8px;
      background: linear-gradient(180deg, #5a5a6a 0%, #4a4a5a 50%, #3a3a4a 100%);
      border-radius: 4px;
      box-shadow:
        inset 0 1px 1px rgba(255,255,255,0.2),
        0 2px 3px rgba(0,0,0,0.3);
      position: relative;
    }

    .ss-label {
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 5px;
      color: rgba(255,255,255,0.4);
      white-space: nowrap;
    }

    .gameboy-shell.dmg-mode .btn-start,
    .gameboy-shell.dmg-mode .btn-select {
      background: linear-gradient(180deg, #808078 0%, #707068 50%, #606058 100%);
    }

    .gameboy-shell.dmg-mode .ss-label {
      color: rgba(60,60,56,0.6);
    }

    .btn-start, .btn-select {
      cursor: pointer;
      transition: transform 0.05s, box-shadow 0.05s;
    }

    .btn-start:active, .btn-select:active {
      box-shadow: inset 0 2px 3px rgba(0,0,0,0.5);
      transform: translateY(1px);
    }

    /* Speaker grille in bottom rim */
    .speaker-grille {
      position: absolute;
      top: 60px;
      right: 15px;
      width: 40px;
      height: 40px;
      background:
        repeating-linear-gradient(
          45deg,
          #4a3a64 0px, #4a3a64 2px,
          #3a2a54 2px, #3a2a54 5px
        );
      border-radius: 50%;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
    }

    .gameboy-shell.dmg-mode .speaker-grille {
      background:
        repeating-linear-gradient(
          180deg,
          #606058 0px, #606058 4px,
          #808078 4px, #808078 6px
        );
      border-radius: 4px;
      width: 45px;
      height: 35px;
      top: 65px;
    }

    /* Footer links - positioned in bottom rim */
    .footer {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      white-space: nowrap;
    }

    .x-link {
      font-size: 9px;
      color: rgba(255,255,255,0.6);
      text-decoration: none;
      transition: color 0.2s;
    }

    .x-link:hover { color: #fff; }

    .link-divider {
      color: rgba(255,255,255,0.3);
      margin: 0 10px;
      font-size: 9px;
    }

    .gameboy-shell.dmg-mode .x-link {
      color: rgba(60,60,56,0.7);
    }

    .gameboy-shell.dmg-mode .x-link:hover {
      color: #2a2a28;
    }

    .gameboy-shell.dmg-mode .link-divider {
      color: rgba(60,60,56,0.4);
    }

    /* Power LED */
    .power-led {
      position: absolute;
      top: 8px;
      left: 78px;
      width: 6px;
      height: 6px;
      background: #58f858;
      border-radius: 50%;
      box-shadow: 0 0 6px #58f858;
      animation: ledPulse 2s ease-in-out infinite;
    }

    @keyframes ledPulse {
      0%, 100% { box-shadow: 0 0 8px #58f858; }
      50% { box-shadow: 0 0 15px #58f858, 0 0 25px #20b820; }
    }

    @media (max-width: 450px) {
      .gameboy-shell { padding: 0.8rem 0.5rem 1.5rem 0.5rem; }
      .stat-name { font-size: 11px; }
      .stat-level { font-size: 10px; }
      .message-text { font-size: 13px; }
      .action-btn { font-size: 11px; }
      .move-btn { font-size: 10px; padding: 6px 2px 6px 18px; }
      .item-btn { font-size: 10px; }
      .move-info { width: 28%; padding: 8px 6px; font-size: 10px; margin: 6px 4px; }
      .moves-box { margin: 6px; padding: 6px; }
      .sweetbun-sprite { transform: scale(5); }
      .flame-sprite { transform: scale(5); }
      .void-sprite { transform: scale(4.5); }
      .inferno-sprite { transform: scale(4.5); }
    }
  </style>
</head>
<body>
  <div class="gameboy-shell" id="gameboy-shell">
    <div class="mode-switch-container">
      <span class="mode-label left">Classic</span>
      <div class="power-switch on" id="power-switch" title="Toggle Classic/GBC"></div>
      <span class="mode-label right">GBC</span>
    </div>
    <div class="gameboy-header">
      <div class="gameboy-label" id="gameboy-label">GAME BOY <span>COLOR</span></div>
    </div>
    <div class="screen-bezel">
      <div class="viewport" id="viewport">
        <div class="impact-flash" id="impact-flash"></div>

        <!-- Enemy HP box - top left -->
        <div class="stat-box enemy">
          <div class="stat-row">
            <span class="stat-name">SPECTER</span>
            <span class="stat-level">50</span>
          </div>
          <div class="hp-row">
            <span class="hp-label">HP</span>
            <div class="hp-bar-bg">
              <div class="hp-bar-inner" id="enemy-hp" style="width: 100%"></div>
            </div>
          </div>
        </div>

        <!-- Player HP box - bottom right -->
        <div class="stat-box player">
          <div class="stat-row">
            <span class="stat-name">SWEETBUN</span>
            <span class="stat-level">50</span>
          </div>
          <div class="hp-row">
            <span class="hp-label">HP</span>
            <div class="hp-bar-bg">
              <div class="hp-bar-inner" id="player-hp" style="width: 100%"></div>
            </div>
          </div>
          <div class="hp-numbers"><span id="player-hp-num">100</span>/ 100</div>
          <div class="exp-bar-bg" style="margin-top: 4px;">
            <div class="exp-bar-inner" id="exp-bar" style="width: 0%"></div>
          </div>
        </div>

        <!-- Battle arena -->
        <div class="battle-arena">
          <div class="platform-enemy"></div>
          <div class="platform-player"></div>

          <!-- Enemy creature -->
          <div class="creature creature-enemy" id="enemy-creature">
            <div class="void-sprite">
              <div class="pixel-sprite"></div>
            </div>
          </div>

          <!-- Player creature -->
          <div class="creature creature-player" id="player-creature">
            <div class="sweetbun-sprite">
              <div class="pixel-sprite"></div>
            </div>
          </div>
        </div>

        <!-- Main battle panel -->
        <div class="battle-panel" id="main-panel">
          <div class="message-box">
            <div class="message-text" id="battle-message">What will<br>SWEETBUN do?</div>
          </div>
          <div class="action-box">
            <div class="action-btn" data-action="fight">FIGHT</div>
            <div class="action-btn" data-action="bag">BAG</div>
            <div class="action-btn" data-action="pokemon">PKMN</div>
            <div class="action-btn" data-action="run">RUN</div>
          </div>
        </div>

        <!-- Fight panel -->
        <div class="fight-panel" id="fight-panel">
          <div class="moves-box">
            <div class="move-btn" data-move="crunch">CRUNCH</div>
            <div class="move-btn" data-move="flamethrower">FLAMETHWR</div>
            <div class="move-btn" data-move="shadow-ball">SHADOWBALL</div>
            <div class="move-btn" data-move="fire-blast">FIREBLAST</div>
          </div>
          <div class="move-info">
            <div id="move-type">TYPE/FIRE</div>
            <div id="move-pp">PP 25/25</div>
          </div>
        </div>

        <!-- Items panel -->
        <div class="items-panel" id="items-panel">
          <div class="items-list">
            <div class="item-btn" data-item="potion">POTION<span class="item-count">x3</span></div>
            <div class="item-btn" data-item="burn-heal">BURN HEAL<span class="item-count">x2</span></div>
            <div class="item-btn" data-item="antidote">ANTIDOTE<span class="item-count">x2</span></div>
            <div class="item-btn" data-item="cancel">BACK</div>
          </div>
          <div class="move-info">
            <div>Use on<br>SWEETBUN?</div>
          </div>
        </div>

        <!-- Pokemon-style announcement box -->
        <div class="announce-box" id="announce-box">
          <div class="announce-text" id="announce-text"></div>
        </div>
      </div>
    </div>
    <div class="dmg-brand">
      <div class="nintendo-text">Nintendo</div>
      <div class="gameboy-text">GAME BOY<span class="tm-text">TM</span></div>
    </div>
    <div class="bottom-rim">
      <div class="power-led"></div>
      <div class="battery-label">BATTERY</div>

      <!-- D-Pad -->
      <div class="dpad">
        <div class="dpad-up" id="dpad-up"></div>
        <div class="dpad-down" id="dpad-down"></div>
        <div class="dpad-left" id="dpad-left"></div>
        <div class="dpad-right" id="dpad-right"></div>
        <div class="dpad-horizontal"></div>
        <div class="dpad-vertical"></div>
        <div class="dpad-center"></div>
      </div>

      <!-- A/B Buttons -->
      <div class="ab-buttons">
        <div class="btn-b" id="btn-b"><span class="btn-label">B</span></div>
        <div class="btn-a" id="btn-a"><span class="btn-label">A</span></div>
      </div>

      <!-- START/SELECT -->
      <div class="start-select">
        <div class="btn-select" id="btn-select"><span class="ss-label">SELECT</span></div>
        <div class="btn-start" id="btn-start"><span class="ss-label">START</span></div>
      </div>
      <!-- Speaker grille indicator -->
      <div class="speaker-grille"></div>

      <div class="footer">
        <a href="mailto:hello@baguette.art" class="x-link">hello@baguette.art</a>
        <span class="link-divider">/</span>
        <a href="https://x.com/baguetteanon" target="_blank" rel="noopener" class="x-link">@baguetteanon</a>
      </div>
    </div>
  </div>

  <script>
    const viewport = document.getElementById('viewport');
    const enemyHpBar = document.getElementById('enemy-hp');
    const playerHpBar = document.getElementById('player-hp');
    const playerHpNum = document.getElementById('player-hp-num');
    const battleMessage = document.getElementById('battle-message');
    const mainPanel = document.getElementById('main-panel');
    const fightPanel = document.getElementById('fight-panel');
    const itemsPanel = document.getElementById('items-panel');
    const playerCreature = document.getElementById('player-creature');
    const enemyCreature = document.getElementById('enemy-creature');
    const impactFlash = document.getElementById('impact-flash');

    // DMG/GBC Mode Toggle
    const gameboyShell = document.getElementById('gameboy-shell');
    const powerSwitch = document.getElementById('power-switch');
    const gameboyLabel = document.getElementById('gameboy-label');

    powerSwitch.addEventListener('click', () => {
      const goingToColor = gameboyShell.classList.contains('dmg-mode');

      if (goingToColor) {
        // Color burst shader: DMG → Color
        viewport.classList.add('mode-transition-color');

        setTimeout(() => {
          powerSwitch.classList.toggle('on');
          gameboyShell.classList.toggle('dmg-mode');
          gameboyLabel.innerHTML = 'GAME BOY <span>COLOR</span>';
        }, 75);

        setTimeout(() => {
          viewport.classList.remove('mode-transition-color');
        }, 300);
      } else {
        // LCD drain shader: Color → DMG
        viewport.classList.add('mode-transition-drain');

        setTimeout(() => {
          powerSwitch.classList.toggle('on');
          gameboyShell.classList.toggle('dmg-mode');
          gameboyLabel.innerHTML = 'GAME BOY';
          viewport.classList.remove('mode-transition-drain');
        }, 350);
      }
    });

    let playerHp = 100;
    let enemyHp = 100;
    let playerLevel = 50;
    let playerExp = 0;
    let currentMenu = 'main';
    let isAnimating = false;
    let currentEnemy = 0;

    // Status effects
    let playerStatus = null; // 'burn' or 'poison'
    const STATUS_CHANCE = 0.30; // 30% chance

    function applyStatusEffect(status) {
      if (playerStatus) return; // Already has a status
      if (Math.random() > STATUS_CHANCE) return; // 30% chance

      playerStatus = status;
      playerCreature.classList.add(status === 'burn' ? 'burning' : 'poisoned');

      // Add status icon to player stat box
      const statName = document.querySelector('.stat-box.player .stat-name');
      if (!statName.querySelector('.status-icon')) {
        const icon = document.createElement('span');
        icon.className = `status-icon ${status}`;
        icon.textContent = status === 'burn' ? 'BRN' : 'PSN';
        statName.appendChild(icon);
      }
    }

    function processStatusDamage(callback) {
      if (!playerStatus || playerHp <= 0) {
        callback();
        return;
      }

      const statusDmg = Math.floor(playerHp * 0.08); // 8% of current HP
      const statusName = playerStatus === 'burn' ? 'burn' : 'poison';

      showMessage(`SWEETBUN is hurt<br>by its ${statusName}!`);

      setTimeout(() => {
        playerHp = Math.max(1, playerHp - statusDmg); // Don't kill from status
        updateHpBar(playerHpBar, playerHp, true);
        vibrateOnDamage();

        const rect = playerCreature.getBoundingClientRect();
        const vRect = viewport.getBoundingClientRect();
        const x = rect.left - vRect.left + rect.width / 2;
        const y = rect.top - vRect.top + rect.height / 2;

        showDamage(x, y - 30, statusDmg);
        spawnParticleBurst(playerStatus === 'burn' ? 'ember' : 'sludge', x, y, 5, 20);

        setTimeout(callback, 600);
      }, 800);
    }

    function clearPlayerStatus() {
      playerStatus = null;
      playerCreature.classList.remove('burning', 'poisoned');
      const icon = document.querySelector('.stat-box.player .status-icon');
      if (icon) icon.remove();
    }

    const enemies = [
      { name: 'SPECTER', level: 50, hp: 100, maxHp: 100, exp: 150, sprite: 'void', type: 'GHOST', attack: 'SHADOW SNEAK', damage: [10, 18] },
      { name: 'MOLDSPORE', level: 52, hp: 110, maxHp: 110, exp: 170, sprite: 'moldspore', type: 'POISON', attack: 'TOXIC SPORE', damage: [10, 16], shader: 'toxic' },
      { name: 'CRYSTOWL', level: 54, hp: 130, maxHp: 130, exp: 200, sprite: 'crystowl', type: 'ICE', attack: 'FROST WING', damage: [14, 22], shader: 'ice' },
      { name: 'SLIME', level: 56, hp: 140, maxHp: 140, exp: 220, sprite: 'slime', type: 'POISON', attack: 'SLUDGE BOMB', damage: [14, 22] },
      { name: 'INFERNO', level: 58, hp: 160, maxHp: 160, exp: 280, sprite: 'inferno', type: 'FIRE', attack: 'FLAME BURST', damage: [16, 26] }
    ];

    // Type effectiveness
    function getTypeMultiplier(moveType, enemyType) {
      const chart = {
        'FIRE': { 'FIRE': 0.5, 'GHOST': 1, 'POISON': 1, 'ICE': 2 },
        'GHOST': { 'GHOST': 2, 'FIRE': 1, 'POISON': 1, 'ICE': 1 },
        'DARK': { 'GHOST': 2, 'FIRE': 1, 'POISON': 1, 'ICE': 1 },
        'ICE': { 'FIRE': 0.5, 'ICE': 0.5, 'GHOST': 1, 'POISON': 1 }
      };
      return chart[moveType]?.[enemyType] || 1;
    }

    const moves = {
      'crunch': { pp: 15, maxPp: 15, type: 'DARK', power: 20, particles: 'crunch' },
      'flamethrower': { pp: 15, maxPp: 15, type: 'FIRE', power: 25, particles: 'flamethrower' },
      'shadow-ball': { pp: 15, maxPp: 15, type: 'GHOST', power: 20, particles: 'shadow' },
      'fire-blast': { pp: 5, maxPp: 5, type: 'FIRE', power: 35, particles: 'blast' }
    };

    const items = {
      'potion': { count: 3, heal: 20, particles: 'heal' },
      'burn-heal': { count: 2, heal: 0, particles: 'burn-cure', cures: 'burn' },
      'antidote': { count: 2, heal: 0, particles: 'antidote', cures: 'poison' }
    };

    // Particle system
    function spawnParticle(type, x, y, extraStyles = {}) {
      const p = document.createElement('div');
      p.className = `particle ${type}-particle`;
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      Object.assign(p.style, extraStyles);
      viewport.appendChild(p);
      setTimeout(() => p.remove(), 1200);
    }

    function spawnParticleBurst(type, x, y, count, spread) {
      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2 / count) * i;
        const dist = spread * (0.5 + Math.random() * 0.5);
        const px = x + Math.cos(angle) * dist;
        const py = y + Math.sin(angle) * dist;
        const delay = Math.random() * 100;
        setTimeout(() => spawnParticle(type, px, py, {
          '--dx': (Math.random() - 0.5) * 40 + 'px'
        }), delay);
      }
    }

    function spawnHealParticles(type, targetEl, count) {
      const rect = targetEl.getBoundingClientRect();
      const viewRect = viewport.getBoundingClientRect();
      const cx = rect.left - viewRect.left + rect.width / 2;
      const cy = rect.top - viewRect.top + rect.height / 2;

      for (let i = 0; i < count; i++) {
        const delay = i * 80;
        const x = cx + (Math.random() - 0.5) * 60;
        const y = cy + (Math.random() - 0.5) * 60;
        setTimeout(() => {
          if (type === 'max-heal') {
            const hue = (i / count) * 360;
            spawnParticle(type, x, y, {
              background: `hsl(${hue}, 100%, 60%)`,
              boxShadow: `0 0 15px hsl(${hue}, 100%, 70%)`
            });
          } else {
            spawnParticle(type, x, y);
          }
        }, delay);
      }
    }

    function screenShake() {
      viewport.classList.add('shake');
      setTimeout(() => viewport.classList.remove('shake'), 300);
    }

    function triggerImpactFlash() {
      impactFlash.classList.remove('active');
      void impactFlash.offsetWidth;
      impactFlash.classList.add('active');
    }

    function vibrateOnDamage() {
      if (navigator.vibrate) {
        navigator.vibrate([50, 30, 80]); // Short pattern: hit, pause, rumble
      }
    }

    function triggerCritFlash() {
      viewport.classList.add('crit-flash');
      setTimeout(() => viewport.classList.remove('crit-flash'), 250);
    }

    function createScreenSplat() {
      const splat = document.createElement('div');
      splat.className = 'screen-splat';

      // Create random splat blobs
      for (let i = 0; i < 5; i++) {
        const blob = document.createElement('div');
        blob.className = 'splat-blob';
        const size = 30 + Math.random() * 50;
        blob.style.width = size + 'px';
        blob.style.height = size * (0.6 + Math.random() * 0.4) + 'px';
        blob.style.left = (Math.random() * 80 + 10) + '%';
        blob.style.top = (Math.random() * 60 + 10) + '%';
        blob.style.transform = `rotate(${Math.random() * 360}deg)`;
        splat.appendChild(blob);

        // Add drips
        const dripCount = Math.floor(Math.random() * 3) + 1;
        for (let j = 0; j < dripCount; j++) {
          const drip = document.createElement('div');
          drip.className = 'splat-drip';
          drip.style.width = (4 + Math.random() * 6) + 'px';
          drip.style.height = (15 + Math.random() * 20) + 'px';
          drip.style.left = (parseFloat(blob.style.left) + Math.random() * 10 - 5) + '%';
          drip.style.top = (parseFloat(blob.style.top) + size * 0.3 / 5) + '%';
          drip.style.animationDelay = (Math.random() * 0.3) + 's';
          splat.appendChild(drip);
        }
      }

      viewport.appendChild(splat);
      splat.classList.add('active');
      setTimeout(() => splat.remove(), 2500);
    }

    function showMenu(menu) {
      if (isAnimating) return;
      currentMenu = menu;
      mainPanel.style.display = menu === 'main' ? 'flex' : 'none';
      fightPanel.classList.toggle('active', menu === 'fight');
      itemsPanel.classList.toggle('active', menu === 'items');
    }

    function updateHpBar(bar, hp, isPlayer) {
      const currentWidth = parseFloat(bar.style.width) || 100;
      const targetWidth = Math.max(0, hp);
      const duration = 400; // ms
      const startTime = performance.now();

      function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        // Ease out cubic
        const eased = 1 - Math.pow(1 - progress, 3);
        const currentHp = currentWidth + (targetWidth - currentWidth) * eased;

        bar.style.width = currentHp + '%';

        bar.classList.remove('medium', 'low');
        if (currentHp <= 20) bar.classList.add('low');
        else if (currentHp <= 50) bar.classList.add('medium');

        if (isPlayer) playerHpNum.textContent = Math.max(0, Math.round(currentHp));

        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      }

      requestAnimationFrame(animate);
    }

    function showMessage(msg) {
      battleMessage.innerHTML = msg;
    }

    // Pokemon-style announcement box
    const announceBox = document.getElementById('announce-box');
    const announceText = document.getElementById('announce-text');
    let announceQueue = [];
    let isAnnouncing = false;

    function showAnnounce(messages, callback) {
      // messages can be a single string or array of strings
      const msgArray = Array.isArray(messages) ? messages : [messages];
      announceQueue = msgArray;
      isAnnouncing = true;
      showNextAnnounce(callback);
    }

    function showNextAnnounce(callback) {
      if (announceQueue.length === 0) {
        announceBox.classList.remove('visible');
        isAnnouncing = false;
        if (callback) callback();
        return;
      }

      const msg = announceQueue.shift();
      announceText.innerHTML = msg;
      announceBox.classList.add('visible');

      // Tap to continue
      const handleTap = (e) => {
        e.stopPropagation();
        announceBox.removeEventListener('click', handleTap);
        viewport.removeEventListener('click', handleTap);
        showNextAnnounce(callback);
      };

      setTimeout(() => {
        announceBox.addEventListener('click', handleTap);
        viewport.addEventListener('click', handleTap);
      }, 300);
    }

    function createProjectile(fromX, fromY, toX, toY, type, onHit) {
      const proj = document.createElement('div');
      proj.className = `projectile ${type}`;
      proj.style.left = fromX + 'px';
      proj.style.top = fromY + 'px';
      viewport.appendChild(proj);

      // Trail particles
      const trailInterval = setInterval(() => {
        const currentX = parseFloat(proj.style.left);
        const currentY = parseFloat(proj.style.top);
        if (type === 'void') {
          spawnParticle('void', currentX, currentY);
        } else if (type === 'shadow-ball') {
          spawnParticle('shadow', currentX, currentY);
        } else if (type === 'sludge') {
          spawnParticle('sludge', currentX + (Math.random() - 0.5) * 12, currentY + (Math.random() - 0.5) * 12);
        } else if (type === 'ice') {
          spawnParticle('ice', currentX + (Math.random() - 0.5) * 8, currentY + (Math.random() - 0.5) * 8);
        } else if (type === 'spore') {
          spawnParticle('spore', currentX + (Math.random() - 0.5) * 15, currentY + (Math.random() - 0.5) * 15, {
            '--spore-drift': ((Math.random() - 0.5) * 30) + 'px'
          });
        } else {
          spawnParticle('fire', currentX + (Math.random() - 0.5) * 10, currentY + (Math.random() - 0.5) * 10);
        }
      }, 50);

      const duration = type === 'fire-blast' ? 400 : 300;
      const startTime = Date.now();

      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);

        proj.style.left = fromX + (toX - fromX) * eased + 'px';
        proj.style.top = fromY + (toY - fromY) * eased + 'px';

        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          clearInterval(trailInterval);
          proj.remove();
          if (onHit) onHit();
        }
      }
      animate();
    }

    function showDamage(x, y, amount, isCrit = false, isHeal = false) {
      const dmg = document.createElement('div');
      dmg.className = 'damage-num' + (isCrit ? ' crit' : '') + (isHeal ? ' heal' : '');
      dmg.textContent = (isHeal ? '+' : '') + amount;
      dmg.style.left = x + 'px';
      dmg.style.top = y + 'px';
      viewport.appendChild(dmg);
      setTimeout(() => dmg.remove(), 1000);
    }

    function hitCreature(creature) {
      creature.classList.add('hit');
      setTimeout(() => creature.classList.remove('hit'), 400);
    }

    function useMove(moveName) {
      if (isAnimating) return;
      const move = moves[moveName];
      if (!move || move.pp <= 0) return;

      isAnimating = true;
      move.pp--;
      // Update PP display
      document.getElementById('move-pp').textContent = `PP ${move.pp}/${move.maxPp}`;
      const displayName = moveName.replace('-', ' ').toUpperCase();
      showMessage(`SWEETBUN used<br>${displayName}!`);
      showMenu('main');

      const playerRect = playerCreature.getBoundingClientRect();
      const enemyRect = enemyCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();

      const fromX = playerRect.left - viewportRect.left + playerRect.width / 2;
      const fromY = playerRect.top - viewportRect.top + playerRect.height / 2;
      const toX = enemyRect.left - viewportRect.left + enemyRect.width / 2;
      const toY = enemyRect.top - viewportRect.top + enemyRect.height / 2;

      // Charge up particles
      setTimeout(() => {
        spawnParticleBurst('ember', fromX, fromY, 8, 30);
      }, 200);

      setTimeout(() => {
        createProjectile(fromX, fromY, toX, toY, moveName, () => {
          hitCreature(enemyCreature);
          screenShake();
          triggerImpactFlash();

          const isCrit = Math.random() < 0.15;
          const isEvolved = playerCreature.querySelector('div').classList.contains('flame-sprite');
          const evoBonus = isEvolved ? 200 : 0; // BAGUETTE one-shots!
          const enemy = enemies[currentEnemy];
          const typeMultiplier = getTypeMultiplier(move.type, enemy.type);
          let damage = Math.floor((move.power + Math.floor(Math.random() * 10) + (isCrit ? 15 : 0)) * typeMultiplier) + evoBonus;
          enemyHp = Math.max(0, enemyHp - damage);
          updateHpBar(enemyHpBar, enemyHp, false);
          showDamage(toX, toY - 30, damage, isCrit);

          // Critical hit shader
          if (isCrit) {
            triggerCritFlash();
          }

          // Impact particles based on move type
          if (move.particles === 'blast') {
            spawnParticleBurst('blast', toX, toY, 12, 50);
            spawnParticleBurst('fire', toX, toY, 20, 70);
          } else if (move.particles === 'flamethrower') {
            spawnParticleBurst('flame-stream', toX, toY, 10, 40);
          } else if (move.particles === 'shadow') {
            spawnParticleBurst('shadow', toX, toY, 15, 45);
          } else if (move.particles === 'crunch') {
            spawnParticleBurst('crunch', toX, toY, 8, 30);
          } else {
            spawnParticleBurst('ember', toX, toY, 8, 35);
          }

          if (enemyHp <= 0) {
            const enemy = enemies[currentEnemy];
            enemyCreature.classList.add('fainting');

            // Award EXP
            const expGain = enemy.exp;
            playerExp += expGain;
            const expPercent = Math.min(100, (playerExp % 300) / 3);
            document.getElementById('exp-bar').style.width = expPercent + '%';

            // Build announcement messages
            const announcements = [`Wild ${enemy.name}<br>fainted!`, `SWEETBUN gained<br>${expGain} EXP!`];

            // Level up check
            let didLevelUp = false;
            if (playerExp >= 300) {
              playerExp = playerExp % 300;
              playerLevel++;
              didLevelUp = true;
              announcements.push(`SWEETBUN grew to<br>Lv${playerLevel}!`);
            }

            showAnnounce(announcements, () => {
              if (didLevelUp) {
                document.querySelector('.stat-box.player .stat-level').textContent = playerLevel;
                spawnHealParticles('max-heal', playerCreature, 15);
              }

              // Check for next enemy
              if (currentEnemy < enemies.length - 1) {
                currentEnemy++;
                const nextEnemy = enemies[currentEnemy];
                showAnnounce(`Trainer sends out<br>${nextEnemy.name}!`, () => {
                  // Update enemy stats
                  document.querySelector('.stat-box.enemy .stat-name').textContent = nextEnemy.name;
                  document.querySelector('.stat-box.enemy .stat-level').textContent = nextEnemy.level;

                  // Swap sprite
                  const spriteContainer = enemyCreature.querySelector('div');
                  spriteContainer.className = nextEnemy.sprite + '-sprite';

                  enemyHp = nextEnemy.maxHp;
                  updateHpBar(enemyHpBar, 100, false);

                  enemyCreature.classList.remove('fainting');
                  enemyCreature.classList.add('appearing');

                  setTimeout(() => {
                    enemyCreature.classList.remove('appearing');
                    isAnimating = false;
                    showMessage('What will<br>SWEETBUN do?');
                  }, 1000);
                });
              } else {
                // All enemies defeated - Pokemon-style victory!
                isAnimating = true;
                const totalExp = enemies.reduce((sum, e) => sum + e.exp, 0);
                const prizeMoney = 3600;
                const playerSpriteContainer = playerCreature.querySelector('div');
                const willEvolve = playerSpriteContainer.classList.contains('sweetbun-sprite');

                // Step 1: Victory announcement
                showAnnounce('Player defeated<br>TRAINER GHOST!', () => {

                  // Step 2: Trainer Ghost appears
                  const trainerOverlay = document.createElement('div');
                  trainerOverlay.className = 'trainer-overlay';
                  trainerOverlay.innerHTML = `
                    <div class="trainer-sprite-container">
                      <div class="creature-sprite">
                        <div class="trainer-ghost-sprite">
                          <div class="pixel-sprite"></div>
                        </div>
                      </div>
                    </div>
                  `;
                  viewport.appendChild(trainerOverlay);

                  setTimeout(() => {
                    // Step 3: Trainer one-liner
                    showAnnounce([
                      'TRAINER GHOST:<br>"Impressive..."',
                      '"Your bond with your<br>partner is strong."',
                      '"Until we meet<br>again..."'
                    ], () => {
                      // Trainer fades away
                      trainerOverlay.style.transition = 'opacity 1s';
                      trainerOverlay.style.opacity = '0';
                      setTimeout(() => trainerOverlay.remove(), 1000);

                      // Step 4: EXP and Money
                      setTimeout(() => {
                        showAnnounce([
                          `SWEETBUN gained<br>${totalExp} total EXP!`,
                          `Got $${prizeMoney}<br>for winning!`
                        ], () => {
                          spawnHealParticles('super-heal', playerCreature, 12);

                          // Step 5: Evolution (last thing!)
                          if (willEvolve) {
                            setTimeout(() => {
                              showAnnounce('What?<br>SWEETBUN is evolving!', () => {
                                // Hide UI for evolution focus
                                viewport.classList.add('evolution-mode');
                                playerCreature.classList.add('evo-flashing');

                                const rect = playerCreature.getBoundingClientRect();
                                const vRect = viewport.getBoundingClientRect();
                                const cx = rect.left - vRect.left + rect.width / 2;
                                const cy = rect.top - vRect.top + rect.height / 2;

                                const spawnTornado = () => {
                                  for (let i = 0; i < 8; i++) {
                                    setTimeout(() => {
                                      const p = document.createElement('div');
                                      p.className = 'evo-particle';
                                      p.style.left = cx + 'px';
                                      p.style.top = cy + 'px';
                                      p.style.animation = `tornado-spin 1.5s ease-in-out forwards`;
                                      p.style.animationDelay = (i * 0.1) + 's';
                                      viewport.appendChild(p);
                                      setTimeout(() => p.remove(), 2000);
                                    }, i * 60);
                                  }
                                };
                                spawnTornado();
                                setTimeout(spawnTornado, 600);
                                setTimeout(spawnTornado, 1200);

                                setTimeout(() => {
                                  playerSpriteContainer.className = 'flame-sprite';
                                }, 2000);

                                setTimeout(() => {
                                  playerCreature.classList.remove('evo-flashing');
                                  viewport.classList.remove('evolution-mode');
                                  showAnnounce([
                                    'Congratulations!',
                                    'SWEETBUN evolved<br>into BAGUETTE!'
                                  ], () => {
                                    document.querySelector('.stat-box.player .stat-name').textContent = 'BAGUETTE';
                                    spawnHealParticles('super-heal', playerCreature, 20);
                                    showEndingScreen();
                                  });
                                }, 3000);
                              });
                            }, 500);
                          } else {
                            showEndingScreen();
                          }
                        });
                      }, 500);
                    });
                  }, 800);
                });
              }
            });
          } else {
            setTimeout(() => {
              isAnimating = false;
              enemyAttack();
            }, 800);
          }
        });
      }, 500);
    }

    function showEndingScreen() {
      const ending = document.createElement('div');
      ending.className = 'ending-screen';
      ending.innerHTML = `
        <div class="ending-logo">BAGUETTE</div>
        <div class="ending-logo-sub">ART</div>
        <div class="ending-sprite">
          <div class="creature-sprite">
            <div class="flame-sprite">
              <div class="pixel-sprite"></div>
            </div>
          </div>
        </div>
        <div class="ending-text">Thanks for playing!</div>
        <div class="ending-links">
          <a href="mailto:hello@baguette.art">hello@baguette.art</a>
          <a href="https://x.com/baguetteanon" target="_blank">@baguetteanon</a>
        </div>
        <div class="play-again-btn" id="play-again">PLAY AGAIN</div>
      `;
      viewport.appendChild(ending);

      document.getElementById('play-again').addEventListener('click', () => {
        location.reload();
      });
    }

    function enemyAttack() {
      isAnimating = true;
      const enemy = enemies[currentEnemy];
      showMessage(`Wild ${enemy.name}<br>used ${enemy.attack}!`);

      const playerRect = playerCreature.getBoundingClientRect();
      const enemyRect = enemyCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();

      const fromX = enemyRect.left - viewportRect.left + enemyRect.width / 2;
      const fromY = enemyRect.top - viewportRect.top + enemyRect.height / 2;
      const toX = playerRect.left - viewportRect.left + playerRect.width / 2;
      const toY = playerRect.top - viewportRect.top + playerRect.height / 2;

      // Determine projectile and particle types based on enemy
      let projType = 'void', particleType = 'void';
      if (enemy.sprite === 'slime') { projType = 'sludge'; particleType = 'sludge'; }
      else if (enemy.sprite === 'crystowl') { projType = 'ice'; particleType = 'ice'; }
      else if (enemy.sprite === 'moldspore') { projType = 'spore'; particleType = 'spore'; }
      else if (enemy.type === 'FIRE') { projType = 'ember'; particleType = 'ember'; }

      // Enemy charge particles
      setTimeout(() => {
        spawnParticleBurst(particleType, fromX, fromY, 6, 25);
      }, 200);

      setTimeout(() => {

        createProjectile(fromX, fromY, toX, toY, projType, () => {
          hitCreature(playerCreature);
          screenShake();
          triggerImpactFlash();
          vibrateOnDamage();

          // Trigger enemy-specific attack shader
          if (enemy.shader) {
            viewport.classList.add(enemy.shader + '-attack');
            setTimeout(() => viewport.classList.remove(enemy.shader + '-attack'), enemy.shader === 'ice' ? 400 : 500);
          }

          const damage = enemy.damage[0] + Math.floor(Math.random() * (enemy.damage[1] - enemy.damage[0]));
          playerHp = Math.max(0, playerHp - damage);
          updateHpBar(playerHpBar, playerHp, true);
          showDamage(toX, toY - 30, damage);
          spawnParticleBurst(particleType, toX, toY, 10, 40);

          // Screen splat for sludge attacks
          if (particleType === 'sludge') {
            createScreenSplat();
          }

          // Apply status effects (30% chance)
          const oldStatus = playerStatus;
          if (enemy.type === 'POISON' || enemy.sprite === 'slime') {
            applyStatusEffect('poison');
          } else if (enemy.type === 'FIRE') {
            applyStatusEffect('burn');
          }

          // Show status inflicted message
          const statusApplied = !oldStatus && playerStatus;

          const finishTurn = () => {
            if (playerHp <= 15 && playerHp > 0) {
              isAnimating = false;
              setTimeout(() => useAutoHeal(), 800);
            } else if (playerHp <= 0) {
              showMessage('SWEETBUN<br>fainted!');
              isAnimating = false;
              clearPlayerStatus();
              setTimeout(() => {
                playerHp = 100;
                updateHpBar(playerHpBar, 100, true);
                showMessage('SWEETBUN woke up!');
                setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
              }, 2000);
            } else {
              // Process status damage before player's turn
              processStatusDamage(() => {
                isAnimating = false;
                showMessage('What will<br>SWEETBUN do?');
              });
            }
          };

          if (statusApplied) {
            setTimeout(() => {
              const statusMsg = playerStatus === 'burn' ? 'SWEETBUN was<br>burned!' : 'SWEETBUN was<br>poisoned!';
              showMessage(statusMsg);
              setTimeout(finishTurn, 1200);
            }, 600);
          } else {
            setTimeout(finishTurn, 400);
          }
        });
      }, 500);
    }

    function useAutoHeal() {
      isAnimating = true;

      const playerRect = playerCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();
      const cx = playerRect.left - viewportRect.left + playerRect.width / 2;
      const cy = playerRect.top - viewportRect.top + playerRect.height / 2;

      // If poisoned, use antidote first
      if (playerStatus === 'poison' && items['antidote'].count > 0) {
        items['antidote'].count--;
        const btn = document.querySelector('[data-item="antidote"]');
        if (btn) btn.querySelector('.item-count').textContent = `x${items['antidote'].count}`;

        showMessage('SWEETBUN used<br>ANTIDOTE!');
        setTimeout(() => {
          clearPlayerStatus();
          spawnHealParticles('antidote', playerCreature, 12);
          showMessage('SWEETBUN was<br>cured of poison!');
          isAnimating = false;
          setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
        }, 800);
        return;
      }

      // If burned, use burn heal first
      if (playerStatus === 'burn' && items['burn-heal'].count > 0) {
        items['burn-heal'].count--;
        const btn = document.querySelector('[data-item="burn-heal"]');
        if (btn) btn.querySelector('.item-count').textContent = `x${items['burn-heal'].count}`;

        showMessage('SWEETBUN used<br>BURN HEAL!');
        setTimeout(() => {
          clearPlayerStatus();
          spawnHealParticles('burn-cure', playerCreature, 12);
          showMessage('SWEETBUN\'s burn<br>was healed!');
          isAnimating = false;
          setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
        }, 800);
        return;
      }

      // Otherwise use potion for HP
      if (items['potion'].count > 0) {
        items['potion'].count--;
        const btn = document.querySelector('[data-item="potion"]');
        if (btn) btn.querySelector('.item-count').textContent = `x${items['potion'].count}`;

        showMessage('SWEETBUN used<br>POTION!');
        setTimeout(() => {
          showMessage("SWEETBUN's HP<br>was restored!");
          setTimeout(() => {
            const healAmount = Math.min(20, 100 - playerHp);
            playerHp = Math.min(100, playerHp + 20);
            updateHpBar(playerHpBar, playerHp, true);
            spawnHealParticles('heal', playerCreature, 10);
            showDamage(cx, cy - 30, healAmount, false, true);
            isAnimating = false;
            setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
          }, 400);
        }, 800);
      } else {
        isAnimating = false;
        showMessage('What will<br>SWEETBUN do?');
      }
    }

    function useItem(itemName) {
      if (isAnimating) return;
      const item = items[itemName];
      if (!item || item.count <= 0) return;

      isAnimating = true;
      item.count--;
      const btn = document.querySelector(`[data-item="${itemName}"]`);
      if (btn) btn.querySelector('.item-count').textContent = `x${item.count}`;

      const displayName = itemName.toUpperCase().replace('-', ' ');
      showMessage(`SWEETBUN used<br>${displayName}!`);
      showMenu('main');

      const playerRect = playerCreature.getBoundingClientRect();
      const viewportRect = viewport.getBoundingClientRect();
      const cx = playerRect.left - viewportRect.left + playerRect.width / 2;
      const cy = playerRect.top - viewportRect.top + playerRect.height / 2;

      // Status cure items
      if (item.cures) {
        setTimeout(() => {
          if (playerStatus === item.cures) {
            clearPlayerStatus();
            spawnHealParticles(item.particles, playerCreature, 12);
            const cureMsg = item.cures === 'poison' ? 'SWEETBUN was<br>cured of poison!' : 'SWEETBUN\'s burn<br>was healed!';
            showMessage(cureMsg);
          } else {
            showMessage('It won\'t have<br>any effect...');
          }
          setTimeout(() => {
            isAnimating = false;
            enemyAttack();
          }, 1200);
        }, 800);
        return;
      }

      // HP healing items - show message first, then heal (like real Pokemon)
      setTimeout(() => {
        const healAmount = Math.min(item.heal, 100 - playerHp);
        showMessage(`SWEETBUN's HP<br>was restored!`);

        // Delay the actual HP bar fill after the message
        setTimeout(() => {
          playerHp = Math.min(100, playerHp + item.heal);
          updateHpBar(playerHpBar, playerHp, true);
          spawnHealParticles('heal', playerCreature, 10);
          showDamage(cx, cy - 30, healAmount, false, true);

          setTimeout(() => {
            isAnimating = false;
            enemyAttack();
          }, 800);
        }, 400);
      }, 800);
    }

    // Event listeners
    document.querySelectorAll('.action-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (isAnimating) return;
        const action = btn.dataset.action;
        if (action === 'fight') showMenu('fight');
        else if (action === 'bag') showMenu('items');
        else if (action === 'run') {
          showMessage("Can't escape!");
          setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
        }
        else if (action === 'pokemon') {
          showMessage('SWEETBUN is<br>already out!');
          setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
        }
      });
    });

    document.querySelectorAll('.move-btn').forEach(btn => {
      btn.addEventListener('click', () => useMove(btn.dataset.move));
      btn.addEventListener('mouseenter', () => {
        const move = moves[btn.dataset.move];
        if (move) {
          document.getElementById('move-type').textContent = `TYPE/${move.type}`;
          document.getElementById('move-pp').textContent = `PP ${move.pp}/${move.maxPp}`;
        }
      });
    });

    document.querySelectorAll('.item-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.dataset.item === 'cancel') showMenu('main');
        else useItem(btn.dataset.item);
      });
    });

    // Tap creatures
    playerCreature.addEventListener('click', () => {
      if (currentMenu === 'main' && !isAnimating) showMenu('fight');
    });

    enemyCreature.addEventListener('click', () => {
      if (currentMenu === 'main' && !isAnimating) {
        showMessage('Wild SPECTER<br>looks angry!');
        spawnParticleBurst('void',
          enemyCreature.getBoundingClientRect().left - viewport.getBoundingClientRect().left + 40,
          enemyCreature.getBoundingClientRect().top - viewport.getBoundingClientRect().top + 40,
          6, 30);
        setTimeout(() => showMessage('What will<br>SWEETBUN do?'), 1500);
      }
    });

    // ========== D-PAD AND BUTTON NAVIGATION ==========
    let cursorPos = { main: 0, fight: 0, items: 0 };

    function getMenuItems() {
      if (currentMenu === 'main') {
        return document.querySelectorAll('.action-btn');
      } else if (currentMenu === 'fight') {
        return document.querySelectorAll('.move-btn');
      } else if (currentMenu === 'items') {
        return document.querySelectorAll('.item-btn');
      }
      return [];
    }

    function updateCursor() {
      // Clear all selections
      document.querySelectorAll('.action-btn, .move-btn, .item-btn').forEach(btn => {
        btn.classList.remove('selected');
      });

      // Set current selection
      const items = getMenuItems();
      const pos = cursorPos[currentMenu] || 0;
      if (items[pos]) {
        items[pos].classList.add('selected');
        // Update move info if in fight menu
        if (currentMenu === 'fight' && items[pos].dataset.move) {
          const move = moves[items[pos].dataset.move];
          if (move) {
            document.getElementById('move-type').textContent = `TYPE/${move.type}`;
            document.getElementById('move-pp').textContent = `PP ${move.pp}/${move.maxPp}`;
          }
        }
      }
    }

    function moveCursor(direction) {
      if (isAnimating) return;
      const items = getMenuItems();
      if (items.length === 0) return;

      let pos = cursorPos[currentMenu] || 0;
      const cols = 2; // 2-column grid layout

      if (direction === 'up') {
        pos = pos >= cols ? pos - cols : pos;
      } else if (direction === 'down') {
        pos = pos + cols < items.length ? pos + cols : pos;
      } else if (direction === 'left') {
        pos = pos % cols > 0 ? pos - 1 : pos;
      } else if (direction === 'right') {
        pos = pos % cols < cols - 1 && pos + 1 < items.length ? pos + 1 : pos;
      }

      cursorPos[currentMenu] = pos;
      updateCursor();
    }

    function pressA() {
      if (isAnimating) return;
      const items = getMenuItems();
      const pos = cursorPos[currentMenu] || 0;
      if (items[pos]) {
        items[pos].click();
      }
    }

    function pressB() {
      if (isAnimating) return;
      if (currentMenu === 'fight' || currentMenu === 'items') {
        showMenu('main');
      }
    }

    // D-pad event listeners
    document.getElementById('dpad-up').addEventListener('click', () => moveCursor('up'));
    document.getElementById('dpad-down').addEventListener('click', () => moveCursor('down'));
    document.getElementById('dpad-left').addEventListener('click', () => moveCursor('left'));
    document.getElementById('dpad-right').addEventListener('click', () => moveCursor('right'));

    // A/B button listeners
    document.getElementById('btn-a').addEventListener('click', pressA);
    document.getElementById('btn-b').addEventListener('click', pressB);

    // Keyboard support too
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp') moveCursor('up');
      else if (e.key === 'ArrowDown') moveCursor('down');
      else if (e.key === 'ArrowLeft') moveCursor('left');
      else if (e.key === 'ArrowRight') moveCursor('right');
      else if (e.key === 'z' || e.key === 'Z' || e.key === 'Enter') pressA();
      else if (e.key === 'x' || e.key === 'X' || e.key === 'Backspace') pressB();
    });

    // Update cursor when menu changes
    const origShowMenu = showMenu;
    showMenu = function(menu) {
      origShowMenu(menu);
      setTimeout(updateCursor, 10);
    };

    // Initialize cursor on page load
    setTimeout(updateCursor, 100);
  </script>
</body>
</html>
